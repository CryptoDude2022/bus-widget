<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Lovely Venice Apartments ‚Äì Bus Widget</title>

<style>
/* ================= BASE ================= */
* { box-sizing: border-box; margin: 0; padding: 0; }

html, body {
  margin: 0;
  padding: 0;
  background: #fff;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
  color: #1a1a1a;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  line-height: 1.4;
}

#lv-container {
  max-width: 100%;
  margin: 0 auto;
  padding: 16px 0 0 0;
}

/* ================= HEADER ================= */
#lv-header {
  text-align: center;
  margin-bottom: 16px;
  padding: 0 16px;
}

#lv-header-title {
  font-size: 18px;
  font-weight: 700;
  color: #1e3a5f;
  margin-bottom: 4px;
}

#lv-header-subtitle {
  font-size: 13px;
  color: #64748b;
  margin-bottom: 8px;
}

/* ================= LIVE BADGE ================= */
@keyframes pulse {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.4); opacity: 0.6; }
}

#lv-live {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: #ecfdf5;
  padding: 4px 10px;
  border-radius: 12px;
}

.lv-live-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #10b981;
  animation: pulse 2s infinite;
}

.lv-live-text {
  font-size: 11px;
  font-weight: 700;
  color: #059669;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* ================= SELECT MENU ================= */
#lv-menu-row {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  padding: 0 16px;
}

.lv-select {
  flex: 1;
  padding: 12px 14px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  font-size: 14px;
  font-weight: 500;
  background: #fff;
  color: #1a1a1a;
  cursor: pointer;
  appearance: none;
  -webkit-appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 36px;
  min-height: 48px;
  transition: border-color 0.2s, box-shadow 0.2s;
}

.lv-select:focus {
  outline: none;
  border-color: #2563eb;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.lv-lang {
  width: 65px;
  padding: 12px 8px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  font-size: 14px;
  font-weight: 600;
  background: #fff;
  color: #1a1a1a;
  cursor: pointer;
  text-align: center;
  min-height: 48px;
  -webkit-appearance: none;
  appearance: none;
}

.lv-lang:focus {
  outline: none;
  border-color: #2563eb;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

/* ================= MAIN GRID (2 COLUMNS) ================= */
.lv-main-card {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0;
  background: #fff;
}

.lv-col-left {
  padding: 0 20px 20px 16px;
  border-right: 1px solid #e5e7eb;
}

.lv-col-right {
  padding: 0 16px 20px 20px;
}

/* ================= SCHEDULE SECTIONS ================= */
.lv-schedule-section {
  margin-bottom: 24px;
  padding-bottom: 20px;
  border-bottom: 1px solid #e5e7eb;
}

.lv-schedule-section:last-child {
  margin-bottom: 0;
  padding-bottom: 0;
  border-bottom: none;
}

.lv-section-header {
  display: none;
}

.lv-section-icon {
  display: none;
}

.lv-section-icon.outbound {
  display: none;
}

.lv-section-icon.inbound {
  display: none;
}

.lv-section-title {
  font-size: 15px;
  font-weight: 700;
  color: #1e3a5f;
  margin-bottom: 10px;
  display: block;
}

/* ================= ORARI ================= */
.lv-summary {
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  padding: 10px 14px;
  margin-bottom: 14px;
  font-size: 13px;
  font-weight: 500;
  color: #1e3a5f;
  line-height: 1.5;
}

.lv-times {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.lv-pill {
  padding: 8px 14px;
  border-radius: 20px;
  background: #fff;
  border: 1px solid #cbd5e1;
  font-size: 14px;
  font-weight: 600;
  color: #334155;
  transition: all 0.15s ease;
  min-height: 36px;
  display: inline-flex;
  align-items: center;
}

.lv-pill-next {
  background: #1e3a5f;
  border-color: #1e3a5f;
  color: #fff;
}

.lv-pill-time {
  font-weight: 700;
}

/* ================= DIVIDER ================= */
.lv-divider {
  display: none;
}

/* ================= STOP INFO ================= */
.lv-stop-info {
  display: none;
}

.lv-stop-icon {
  display: none;
}

.lv-stop-details {
  flex: 1;
}

.lv-stop-name {
  font-size: 15px;
  font-weight: 700;
  color: #1e3a5f;
  margin-bottom: 12px;
}

.lv-walk-time {
  font-size: 13px;
  color: #64748b;
  margin-bottom: 16px;
  line-height: 1.4;
}

/* ================= MAPPA ================= */
.lv-map {
  width: 100%;
  height: 280px;
  border: 0;
  border-radius: 12px;
  margin-bottom: 14px;
  background: #f1f5f9;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

/* ================= BOTTONI ================= */
.lv-buttons-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

/* ================= PREZZI BIGLIETTI ================= */
.lv-prices {
  background: #f0fdf4;
  border: 1px solid #bbf7d0;
  border-radius: 10px;
  padding: 14px;
  margin-top: 8px;
}

.lv-prices-title {
  font-size: 14px;
  font-weight: 700;
  color: #166534;
  margin-bottom: 12px;
}

.lv-prices-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
}

.lv-price-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #fff;
  padding: 10px 12px;
  border-radius: 8px;
  border: 1px solid #dcfce7;
}

.lv-price-label {
  font-size: 12px;
  color: #374151;
  font-weight: 500;
}

.lv-price-value {
  font-size: 14px;
  font-weight: 700;
  color: #166534;
}

.lv-ticket-info {
  margin-top: 12px;
  padding: 14px;
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  border-radius: 10px;
  border: 2px solid #f59e0b;
  box-shadow: 0 4px 12px rgba(245, 158, 11, 0.25);
  animation: pulse-attention 2s ease-in-out infinite;
}

@keyframes pulse-attention {
  0%, 100% { 
    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.25);
    transform: scale(1);
  }
  50% { 
    box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
    transform: scale(1.01);
  }
}

.lv-ticket-info p {
  font-size: 13px;
  color: #92400e;
  margin: 0 0 10px 0;
  line-height: 1.5;
  font-weight: 500;
}

.lv-ticket-info p:last-child {
  margin-bottom: 0;
}

.lv-btn {
  padding: 14px 16px;
  border-radius: 25px;
  text-align: center;
  text-decoration: none;
  font-weight: 600;
  font-size: 13px;
  border: none;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  min-height: 48px;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  cursor: pointer;
  user-select: none;
}

.lv-btn-primary {
  background: #2563eb;
  color: white;
}

.lv-btn-secondary {
  background: #2563eb;
  color: white;
}

.lv-btn-prices {
  background: linear-gradient(135deg, #f59e0b, #d97706);
  color: white;
  border: none;
  cursor: pointer;
}

.lv-btn-prices:hover {
  background: linear-gradient(135deg, #d97706, #b45309);
}

/* Full width prices button */
.lv-prices-full-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  width: 100%;
  padding: 14px 20px;
  margin-top: 12px;
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  border: none;
  border-radius: 12px;
  color: #fff;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
}

.lv-prices-full-btn:hover {
  background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
}

.lv-prices-full-btn:active {
  transform: scale(0.98);
}

.lv-prices-full-btn-icon {
  font-size: 18px;
}

.lv-prices-full-btn-text {
  letter-spacing: 0.3px;
}

.lv-btn:hover {
  background: #1d4ed8;
  transform: translateY(-1px);
}

.lv-btn:active {
  transform: scale(0.97);
  background: #1e40af;
}

/* ================= RESPONSIVE TABLET ================= */
@media(max-width:768px){
  .lv-main-card {
    grid-template-columns: 1fr;
  }
  
  .lv-col-left {
    border-right: none;
    border-bottom: 1px solid #e5e7eb;
    padding: 0 16px 24px 16px;
  }
  
  .lv-col-right {
    padding: 24px 16px 20px 16px;
  }
  
  .lv-map {
    height: 240px;
  }
  
  .lv-prices-grid {
    grid-template-columns: 1fr 1fr;
  }
}

/* ================= RESPONSIVE MOBILE ================= */
@media(max-width:480px){
  #lv-container {
    padding-top: 8px;
  }
  
  #lv-header {
    margin-bottom: 10px;
    padding: 0 10px;
  }
  
  #lv-header-title {
    font-size: 15px;
  }
  
  #lv-header-subtitle {
    font-size: 11px;
  }
  
  #lv-menu-row { 
    padding: 0 10px;
    margin-bottom: 10px;
    gap: 6px;
  }
  
  .lv-select {
    padding: 8px 10px;
    font-size: 12px;
    min-height: 38px;
  }
  
  .lv-lang {
    width: 52px;
    padding: 8px 4px;
    font-size: 12px;
    min-height: 38px;
  }
  
  .lv-col-left {
    padding: 0 10px 12px 10px;
  }
  
  .lv-col-right {
    padding: 12px 10px 10px 10px;
  }
  
  .lv-section-title {
    font-size: 12px;
    margin-bottom: 6px;
  }
  
  .lv-summary {
    padding: 6px 10px;
    font-size: 11px;
    margin-bottom: 8px;
  }
  
  .lv-times {
    gap: 4px;
  }
  
  .lv-pill {
    padding: 5px 8px;
    font-size: 11px;
    min-height: 28px;
    border-radius: 14px;
  }
  
  .lv-stop-name {
    font-size: 12px;
    margin-bottom: 6px;
  }
  
  .lv-walk-time {
    font-size: 11px;
    margin-bottom: 8px;
  }
  
  .lv-map { 
    height: 160px;
    border-radius: 8px;
    margin-bottom: 10px;
  }
  
  .lv-buttons-row { 
    gap: 6px; 
  }
  
  .lv-btn { 
    padding: 10px 8px;
    font-size: 11px;
    min-height: 38px;
    border-radius: 18px;
  }
  
  .lv-schedule-section {
    margin-bottom: 10px;
    padding-bottom: 10px;
  }
  
  .lv-prices {
    padding: 10px;
    margin-top: 4px;
  }
  
  .lv-prices-title {
    font-size: 12px;
    margin-bottom: 8px;
  }
  
  .lv-prices-grid {
    grid-template-columns: 1fr 1fr;
    gap: 4px;
  }
  
  .lv-price-item {
    padding: 6px 8px;
  }
  
  .lv-price-label {
    font-size: 10px;
  }
  
  .lv-price-value {
    font-size: 11px;
  }
  
  .lv-ticket-info {
    padding: 10px;
    margin-top: 8px;
  }
  
  .lv-ticket-info p {
    font-size: 11px;
    margin: 0 0 6px 0;
  }
  
  /* Airport bus selector mobile */
  .lv-airport-bus-selector {
    margin-bottom: 8px;
  }
  
  .lv-airport-bus-select {
    padding: 10px 12px;
    font-size: 12px;
    border-radius: 8px;
  }
  
  /* Lista orizzontale orari mobile */
  .lv-dep-list-horizontal {
    gap: 4px;
  }
  
  .lv-dep-list-horizontal .lv-dep-item {
    padding: 6px 4px;
    min-width: 0;
  }
  
  .lv-dep-list-horizontal .lv-dep-time {
    font-size: 13px;
  }
  
  .lv-dep-list-horizontal .lv-dep-countdown {
    font-size: 9px;
  }
  
  .lv-widget-container {
    padding: 0 10px;
  }
  
  .lv-route-card {
    padding: 10px;
    margin-bottom: 8px;
    border-radius: 10px;
  }
  
  .lv-route-header {
    gap: 8px;
    margin-bottom: 10px;
  }
  
  .lv-route-icon {
    font-size: 18px;
    width: 32px;
    height: 32px;
    border-radius: 8px;
  }
  
  .lv-route-title {
    font-size: 13px;
  }
  
  .lv-route-subtitle {
    font-size: 10px;
  }
  
  .lv-route-badge {
    padding: 3px 8px;
    font-size: 11px;
  }
  
  .lv-route-departures {
    padding: 8px;
    border-radius: 8px;
  }
  
  .lv-dep-label {
    font-size: 9px;
    margin-bottom: 6px;
  }
  
  .lv-dep-list {
    gap: 4px;
  }
  
  .lv-dep-item {
    padding: 8px 10px;
    border-radius: 6px;
  }
  
  .lv-dep-line-badge {
    padding: 2px 6px;
    font-size: 9px;
  }
  
  .lv-dep-time {
    font-size: 14px;
  }
  
  .lv-dep-countdown {
    font-size: 11px;
  }
}

/* ================= EXTRA SMALL SCREENS ================= */
@media(max-width:360px){
  #lv-header-title {
    font-size: 13px;
  }
  
  #lv-header-subtitle {
    font-size: 10px;
  }
  
  .lv-select {
    font-size: 11px;
    padding: 7px 8px;
    min-height: 34px;
  }
  
  .lv-lang {
    width: 45px;
    font-size: 11px;
    min-height: 34px;
  }
  
  .lv-pill {
    padding: 4px 6px;
    font-size: 10px;
    min-height: 24px;
  }
  
  .lv-btn {
    font-size: 10px;
    padding: 8px 6px;
    min-height: 34px;
  }
  
  .lv-map {
    height: 120px;
  }
  
  .lv-prices-grid {
    grid-template-columns: 1fr 1fr;
    gap: 3px;
  }
  
  .lv-price-item {
    padding: 5px 6px;
  }
  
  .lv-price-label {
    font-size: 9px;
  }
  
  .lv-price-value {
    font-size: 10px;
  }
  
  .lv-route-card {
    padding: 10px;
  }
  
  .lv-route-icon {
    width: 28px;
    height: 28px;
    font-size: 16px;
  }
  
  .lv-route-title {
    font-size: 12px;
  }
  
  .lv-route-badge {
    padding: 2px 6px;
    font-size: 10px;
  }
  
  .lv-dep-item {
    padding: 6px 8px;
  }
  
  .lv-dep-time {
    font-size: 14px;
  }
  
  .lv-dep-countdown {
    font-size: 10px;
  }
  
  .lv-ticket-info {
    padding: 8px;
  }
  
  .lv-ticket-info p {
    font-size: 10px;
    margin: 0 0 5px 0;
  }
  
  /* Airport bus selector extra small */
  .lv-airport-bus-select {
    padding: 8px 10px;
    font-size: 11px;
  }
  
  /* Lista orizzontale orari extra small */
  .lv-dep-list-horizontal .lv-dep-item {
    padding: 5px 3px;
  }
  
  .lv-dep-list-horizontal .lv-dep-time {
    font-size: 12px;
  }
  
  .lv-dep-list-horizontal .lv-dep-countdown {
    font-size: 8px;
  }
}

/* ================= SAFE AREA FOR NOTCHED PHONES ================= */
@supports(padding: max(0px)) {
  #lv-container {
    padding-left: max(0px, env(safe-area-inset-left));
    padding-right: max(0px, env(safe-area-inset-right));
  }
  
  .lv-col-left, .lv-col-right, #lv-menu-row, #lv-header {
    padding-left: max(12px, env(safe-area-inset-left));
    padding-right: max(12px, env(safe-area-inset-right));
  }
}

/* ================= DARK MODE SUPPORT ================= */
@media (prefers-color-scheme: dark) {
  /* Kept light for Lodgify consistency */
}

/* ================= BOTTOM BAR MOBILE ================= */
#lv-bottom-bar {
  display: none;
}

/* ================= NEW MAIN WIDGET DESIGN ================= */
.lv-widget-container {
  padding: 0 16px;
}

.lv-route-card {
  background: linear-gradient(135deg, #1e3a5f 0%, #0d2137 100%);
  border-radius: 10px;
  padding: 10px;
  margin-bottom: 8px;
  color: #fff;
  border: 1px solid rgba(255,255,255,0.1);
}

.lv-route-card-return {
  background: linear-gradient(135deg, #065f46 0%, #064e3b 100%);
}

.lv-route-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
}

.lv-route-icon {
  font-size: 18px;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255,255,255,0.1);
  border-radius: 8px;
}

.lv-route-info {
  flex: 1;
}

.lv-route-title {
  font-size: 13px;
  font-weight: 700;
  color: #fff;
  margin-bottom: 1px;
}

.lv-route-subtitle {
  font-size: 10px;
  color: rgba(255,255,255,0.6);
}

.lv-route-badge {
  background: #ef4444;
  color: #fff;
  padding: 3px 8px;
  border-radius: 10px;
  font-size: 11px;
  font-weight: 800;
}

.lv-badge-return {
  background: #10b981;
}

.lv-route-departures {
  background: rgba(0,0,0,0.05);
  border-radius: 8px;
  padding: 8px;
}

.lv-dep-label {
  font-size: 9px;
  color: rgba(255,255,255,0.5);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 6px;
}

.lv-dep-list {
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  gap: 6px;
}

/* Versione orizzontale per aeroporto */
.lv-dep-list-horizontal {
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  gap: 6px;
}

.lv-dep-list-horizontal .lv-dep-item,
.lv-dep-list .lv-dep-item {
  flex: 1 1 auto;
  min-width: 80px;
  justify-content: center;
  flex-direction: column;
  gap: 2px;
  padding: 6px 4px;
}

.lv-dep-list-horizontal .lv-dep-time-block,
.lv-dep-list .lv-dep-time-block {
  justify-content: center;
}

.lv-dep-list-horizontal .lv-dep-countdown,
.lv-dep-list .lv-dep-countdown {
  font-size: 10px;
  text-align: center;
}

.lv-dep-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: rgba(255,255,255,0.08);
  border-radius: 6px;
  padding: 6px 8px;
}

.lv-dep-item:first-child {
  background: rgba(34, 197, 94, 0.2);
  border: 1px solid rgba(34, 197, 94, 0.3);
}

.lv-dep-time-block {
  display: flex;
  align-items: center;
  gap: 6px;
}

.lv-dep-line-badge {
  background: rgba(255,255,255,0.15);
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 9px;
  font-weight: 700;
  color: #fff;
}

.lv-dep-time {
  font-size: 15px;
  font-weight: 700;
  color: #fff;
}

.lv-dep-countdown {
  font-size: 11px;
  font-weight: 600;
  color: #fbbf24;
}

.lv-dep-countdown-soon {
  color: #ef4444;
  font-weight: 700;
  animation: pulse 1.5s infinite;
}

.lv-dep-no-more {
  padding: 12px;
  text-align: center;
  color: rgba(255,255,255,0.5);
  font-size: 13px;
}

/* Airport Bus Selector */
.lv-airport-bus-selector {
  margin-bottom: 12px;
}

.lv-airport-bus-selector-label {
  font-size: 12px;
  font-weight: 700;
  color: #fbbf24;
  margin-bottom: 6px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.lv-airport-bus-select {
  width: 100%;
  padding: 10px 14px;
  border-radius: 10px;
  border: 2px solid #fbbf24;
  font-size: 14px;
  font-weight: 700;
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  color: #fff;
  cursor: pointer;
  appearance: none;
  -webkit-appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23fff' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 36px;
  box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
}

.lv-airport-bus-select:focus {
  outline: none;
  border-color: #fff;
  box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.4);
}

.lv-airport-bus-select option {
  background: #1e3a5f;
  color: #fff;
  padding: 10px;
}

/* Stop Card */
.lv-stop-card {
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  padding: 10px;
  margin-bottom: 8px;
}

/* Map Selector Tabs */
.lv-map-selector {
  display: flex;
  gap: 6px;
  margin-bottom: 10px;
}

.lv-map-tab {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 8px 10px;
  border: 2px solid #e2e8f0;
  border-radius: 8px;
  background: #fff;
  cursor: pointer;
  transition: all 0.25s ease;
  font-family: inherit;
  font-size: 11px;
  font-weight: 600;
  color: #374151;
  min-height: 36px;
}

.lv-map-tab:hover {
  border-color: #94a3b8;
  background: #f8fafc;
}

.lv-map-tab.active {
  border-color: #8b5cf6;
  background: #8b5cf6;
  color: #fff;
}

.lv-map-tab-actv {
  border-color: #dc2626;
  background: #fef2f2;
  color: #dc2626;
}

.lv-map-tab-actv.active {
  border-color: #dc2626;
  background: #dc2626;
  color: #fff;
}

.lv-map-tab-atvo {
  border-color: #ea580c;
  background: #fff7ed;
  color: #ea580c;
}

.lv-map-tab-atvo.active {
  border-color: #ea580c;
  background: #ea580c;
  color: #fff;
}

.lv-map-tab-treviso {
  border-color: #8b5cf6;
  background: #f5f3ff;
  color: #7c3aed;
}

.lv-map-tab-treviso.active {
  border-color: #8b5cf6;
  background: #8b5cf6;
  color: #fff;
}

.lv-map-tab-treviso-ret {
  border-color: #8b5cf6;
  background: #fff;
  color: #7c3aed;
}

.lv-map-tab-treviso-ret.active {
  border-color: #7c3aed;
  background: #7c3aed;
  color: #fff;
}

.lv-tab-icon {
  font-size: 16px;
}

.lv-tab-label {
  white-space: nowrap;
}

.lv-stop-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 14px;
}

.lv-stop-icon-big {
  font-size: 28px;
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #e0f2fe;
  border-radius: 12px;
}

.lv-stop-info-text {
  flex: 1;
}

.lv-stop-card .lv-stop-name {
  font-size: 16px;
  font-weight: 700;
  color: #1e3a5f;
  margin-bottom: 4px;
}

.lv-stop-card .lv-walk-time {
  font-size: 13px;
  color: #64748b;
  margin: 0;
}

.lv-mini-map {
  width: 100%;
  height: 220px;
  border: 0;
  border-radius: 10px;
  margin-bottom: 12px;
  background: #e2e8f0;
}

.lv-stop-buttons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}

.lv-stop-buttons .lv-btn {
  font-size: 13px;
  padding: 14px 12px;
}

/* Prices Card - Compact Version */
.lv-prices-card {
  background: linear-gradient(135deg, #1e3a5f 0%, #0d2137 100%);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 14px;
  padding: 12px;
  margin-bottom: 12px;
  color: #fff;
}

.lv-prices-compact {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  flex-wrap: wrap;
}

.lv-prices-main {
  display: flex;
  align-items: center;
  gap: 10px;
}

.lv-prices-bus-price {
  display: flex;
  align-items: center;
  gap: 6px;
  background: rgba(34, 197, 94, 0.2);
  border: 1px solid rgba(34, 197, 94, 0.3);
  padding: 8px 12px;
  border-radius: 8px;
}

.lv-prices-bus-price .lv-price-icon {
  font-size: 16px;
}

.lv-prices-bus-price .lv-price-label {
  font-size: 12px;
  color: rgba(255,255,255,0.8);
}

.lv-prices-bus-price .lv-price-value {
  font-size: 16px;
  font-weight: 700;
  color: #22c55e;
}

.lv-prices-more-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  background: rgba(251, 191, 36, 0.2);
  border: 1px solid rgba(251, 191, 36, 0.4);
  padding: 8px 12px;
  border-radius: 8px;
  color: #fbbf24;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
}

.lv-prices-more-btn:hover {
  background: rgba(251, 191, 36, 0.3);
}

/* Prices Popup Modal */
.lv-prices-popup-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  z-index: 99999;
  justify-content: center;
  align-items: center;
  padding: 20px;
  box-sizing: border-box;
}

.lv-prices-popup-overlay.active {
  display: flex;
}

.lv-prices-popup {
  background: linear-gradient(135deg, #1e3a5f 0%, #0d2137 100%);
  border-radius: 16px;
  padding: 20px;
  max-width: 380px;
  width: 100%;
  color: #fff;
  position: relative;
  max-height: 80vh;
  overflow-y: auto;
  margin: auto;
}

@media (max-width: 480px) {
  .lv-prices-popup-overlay {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    height: 100dvh !important;
    padding: 0;
    margin: 0;
    align-items: flex-end;
    justify-content: center;
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
  }
  .lv-prices-popup {
    max-width: 100vw;
    width: 100%;
    max-height: 85vh;
    max-height: 85dvh;
    border-radius: 20px 20px 0 0;
    margin: 0;
    padding: 24px 20px 34px 20px;
    animation: slideUpMobile 0.3s ease-out;
    -webkit-overflow-scrolling: touch;
  }
  .lv-prices-popup-close {
    width: 40px;
    height: 40px;
    font-size: 20px;
    top: 16px;
    right: 16px;
  }
  .lv-prices-popup-title {
    font-size: 20px;
    padding-right: 40px;
  }
  .lv-prices-popup-grid {
    gap: 12px;
  }
  .lv-prices-popup-item {
    padding: 14px 12px;
  }
  .lv-prices-popup-item .lv-price-label {
    font-size: 12px;
  }
  .lv-prices-popup-item .lv-price-value {
    font-size: 20px;
  }
  .lv-prices-popup-note {
    font-size: 13px;
    padding: 12px;
  }
}

@keyframes slideUpMobile {
  from {
    transform: translateY(100%);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.lv-prices-popup-close {
  position: absolute;
  top: 12px;
  right: 12px;
  background: rgba(255,255,255,0.1);
  border: none;
  color: #fff;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.lv-prices-popup-close:hover {
  background: rgba(255,255,255,0.2);
}

.lv-prices-popup-title {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.lv-prices-popup-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  margin-bottom: 16px;
}

.lv-prices-popup-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  background: rgba(255,255,255,0.08);
  padding: 12px 10px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.1);
}

.lv-prices-popup-item .lv-price-label {
  font-size: 11px;
  color: rgba(255,255,255,0.6);
  margin-bottom: 4px;
  text-align: center;
}

.lv-prices-popup-item .lv-price-value {
  font-size: 18px;
  font-weight: 700;
  color: #22c55e;
}

.lv-prices-popup-notes {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.lv-prices-popup-note {
  font-size: 12px;
  color: rgba(255,255,255,0.7);
  text-align: center;
  padding: 10px;
  background: rgba(255,255,255,0.05);
  border-radius: 8px;
}

.lv-prices-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 14px;
}

.lv-prices-icon {
  font-size: 20px;
}

.lv-prices-card .lv-prices-title {
  font-size: 15px;
  font-weight: 700;
  color: #fff;
  margin: 0;
}

.lv-prices-card .lv-prices-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
  margin-bottom: 12px;
}

.lv-prices-card .lv-price-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  background: rgba(255,255,255,0.08);
  padding: 10px 8px;
  border-radius: 8px;
  border: 1px solid rgba(255,255,255,0.1);
}

.lv-prices-card .lv-price-label {
  font-size: 11px;
  color: rgba(255,255,255,0.6);
  margin-bottom: 2px;
}

.lv-prices-card .lv-price-value {
  font-size: 15px;
  font-weight: 700;
  color: #22c55e;
}

.lv-prices-note {
  font-size: 12px;
  color: rgba(255,255,255,0.6);
  text-align: center;
  padding: 10px;
  background: rgba(255,255,255,0.03);
  border-radius: 8px;
  margin-bottom: 8px;
}

.lv-prices-note:last-child {
  margin-bottom: 0;
}

/* Airport specific card styles */
.lv-route-card-airport {
  background: linear-gradient(135deg, #1e3a5f 0%, #0d2137 100%);
}

.lv-route-card-atvo {
  background: linear-gradient(135deg, #78350f 0%, #451a03 100%);
}

.lv-badge-actv-red {
  background: #ef4444;
  color: #fff;
}

.lv-badge-atvo-orange {
  background: linear-gradient(135deg, #f59e0b, #d97706);
  color: #fff;
  font-size: 11px;
}

.lv-stop-card-atvo {
  background: #fffbeb;
  border-color: #fcd34d;
}

/* Treviso Airport styles */
.lv-treviso-widget {
  margin-top: 24px;
  background: rgba(255,255,255,0.95);
  border: 1px solid rgba(124,58,237,0.2);
}

.lv-route-card-treviso {
  background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
}

.lv-badge-treviso {
  background: linear-gradient(135deg, #a855f7, #7c3aed);
  color: #fff;
  font-size: 11px;
}

/* Mobile responsive for new widget */
@media (max-width: 480px) {
  .lv-widget-container {
    padding: 0 10px;
  }
  
  .lv-route-card {
    padding: 10px;
    border-radius: 10px;
    margin-bottom: 8px;
  }
  
  .lv-route-header {
    gap: 8px;
    margin-bottom: 10px;
  }
  
  .lv-route-icon {
    width: 30px;
    height: 30px;
    font-size: 16px;
    border-radius: 8px;
  }
  
  .lv-route-title {
    font-size: 12px;
  }
  
  .lv-route-subtitle {
    font-size: 10px;
  }
  
  .lv-route-badge {
    padding: 3px 8px;
    font-size: 11px;
    border-radius: 10px;
  }
  
  .lv-route-departures {
    padding: 8px;
    border-radius: 8px;
  }
  
  .lv-dep-label {
    font-size: 9px;
    margin-bottom: 5px;
  }
  
  .lv-dep-list {
    gap: 5px;
  }
  
  .lv-dep-item {
    padding: 7px 10px;
    border-radius: 6px;
  }
  
  .lv-dep-line-badge {
    padding: 2px 5px;
    font-size: 9px;
  }
  
  .lv-dep-time {
    font-size: 14px;
  }
  
  .lv-dep-countdown {
    font-size: 10px;
  }
  
  .lv-stop-card {
    padding: 10px;
    border-radius: 10px;
    margin-bottom: 8px;
  }
  
  .lv-stop-header {
    gap: 8px;
    margin-bottom: 10px;
  }
  
  .lv-stop-icon-big {
    font-size: 20px;
    width: 36px;
    height: 36px;
    border-radius: 8px;
  }
  
  .lv-stop-card .lv-stop-name {
    font-size: 13px;
    margin-bottom: 2px;
  }
  
  .lv-stop-card .lv-walk-time {
    font-size: 11px;
  }
  
  .lv-mini-map {
    height: 100px;
    border-radius: 8px;
    margin-bottom: 8px;
  }
  
  .lv-map-selector {
    gap: 5px;
    margin-bottom: 10px;
  }
  
  .lv-map-tab {
    padding: 8px 10px;
    font-size: 11px;
    border-radius: 8px;
    min-height: 36px;
    gap: 5px;
  }
  
  .lv-tab-icon {
    font-size: 12px;
  }
  
  .lv-stop-buttons {
    grid-template-columns: 1fr 1fr;
    gap: 6px;
  }
  
  .lv-stop-buttons .lv-btn {
    font-size: 10px;
    padding: 10px 8px;
  }
  
  .lv-prices-card {
    padding: 10px;
    border-radius: 10px;
    margin-bottom: 8px;
  }
  
  .lv-prices-header {
    gap: 6px;
    margin-bottom: 10px;
  }
  
  .lv-prices-icon {
    font-size: 16px;
  }
  
  .lv-prices-card .lv-prices-title {
    font-size: 12px;
  }
  
  .lv-prices-card .lv-prices-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 5px;
    margin-bottom: 8px;
  }
  
  .lv-prices-card .lv-price-item {
    padding: 6px 4px;
    border-radius: 6px;
  }
  
  .lv-prices-card .lv-price-label {
    font-size: 9px;
  }
  
  .lv-prices-card .lv-price-value {
    font-size: 12px;
  }
  
  .lv-prices-note {
    font-size: 10px;
    padding: 8px;
    border-radius: 6px;
    margin-bottom: 6px;
  }
  
  .lv-treviso-widget {
    margin-top: 16px;
  }
}

/* ================= AIRPORT BUS WIDGET (NEW DESIGN) ================= */
.lv-airport-widget {
  margin-top: 16px;
  background: rgba(255,255,255,0.95);
  border-radius: 12px;
  padding: 12px;
  color: #1e3a5f;
  border: 1px solid rgba(30,58,95,0.1);
}

.lv-airport-widget-header {
  text-align: center;
  margin-bottom: 12px;
}

.lv-airport-widget-icon {
  font-size: 24px;
  margin-bottom: 4px;
}

.lv-airport-widget-title {
  font-size: 15px;
  font-weight: 700;
  margin-bottom: 2px;
}

.lv-airport-widget-subtitle {
  font-size: 11px;
  color: rgba(30,58,95,0.6);
}

/* Bus Cards */
.lv-bus-card {
  background: rgba(255,255,255,0.08);
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 16px;
  border: 1px solid rgba(255,255,255,0.1);
}

.lv-bus-card-atvo {
  background: rgba(245, 158, 11, 0.1);
  border-color: rgba(245, 158, 11, 0.2);
}

.lv-bus-card-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 14px;
  flex-wrap: wrap;
  gap: 10px;
}

.lv-bus-card-line {
  display: flex;
  align-items: center;
  gap: 10px;
}

.lv-bus-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 40px;
  height: 28px;
  padding: 0 10px;
  border-radius: 14px;
  font-size: 14px;
  font-weight: 800;
}

.lv-badge-actv {
  background: #ef4444;
  color: #fff;
}

.lv-badge-atvo {
  background: linear-gradient(135deg, #f59e0b, #d97706);
  color: #fff;
  font-size: 11px;
}

.lv-bus-operator {
  font-size: 14px;
  font-weight: 600;
  color: rgba(255,255,255,0.9);
}

.lv-bus-card-info {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.lv-bus-duration, .lv-bus-price, .lv-bus-luggage {
  font-size: 12px;
  color: rgba(255,255,255,0.7);
  background: rgba(255,255,255,0.1);
  padding: 4px 8px;
  border-radius: 6px;
}

/* Direction Buttons */
.lv-bus-directions {
  display: flex;
  gap: 8px;
  margin-bottom: 14px;
}

.lv-bus-dir-btn {
  flex: 1;
  padding: 10px 12px;
  border: none;
  border-radius: 10px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  background: rgba(255,255,255,0.1);
  color: rgba(255,255,255,0.7);
}

.lv-bus-dir-btn.active {
  background: linear-gradient(135deg, #c9b896, #fbbf24);
  color: #1e3a5f;
  box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);
}

.lv-bus-dir-btn:hover:not(.active) {
  background: rgba(255,255,255,0.15);
}

/* Next Departures */
.lv-bus-next-departures {
  margin-bottom: 14px;
}

.lv-next-dep-title {
  font-size: 11px;
  color: rgba(255,255,255,0.5);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 10px;
}

.lv-next-dep-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.lv-next-dep-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 12px;
  background: rgba(255,255,255,0.06);
  border-radius: 10px;
  transition: all 0.2s;
}

.lv-next-dep-item:first-child {
  background: rgba(34, 197, 94, 0.2);
  border: 1px solid rgba(34, 197, 94, 0.3);
}

.lv-next-dep-time {
  font-size: 18px;
  font-weight: 700;
  font-family: 'SF Mono', Monaco, monospace;
  color: #fbbf24;
  min-width: 60px;
}

.lv-next-dep-item:first-child .lv-next-dep-time {
  color: #22c55e;
}

.lv-next-dep-countdown {
  font-size: 13px;
  color: rgba(255,255,255,0.7);
  flex: 1;
}

.lv-next-dep-item:first-child .lv-next-dep-countdown {
  color: rgba(255,255,255,0.9);
}

.lv-next-dep-badge {
  font-size: 10px;
  padding: 3px 8px;
  border-radius: 10px;
  background: rgba(34, 197, 94, 0.3);
  color: #22c55e;
  font-weight: 600;
}

/* Mini Map */
.lv-bus-map-container {
  margin-top: 14px;
  border-radius: 10px;
  overflow: hidden;
  background: rgba(0,0,0,0.2);
}

.lv-bus-map-title {
  padding: 8px 12px;
  font-size: 11px;
  color: rgba(255,255,255,0.6);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.lv-bus-mini-map {
  width: 100%;
  height: 120px;
  border: none;
}

.lv-bus-stop-address {
  padding: 8px 12px;
  font-size: 12px;
  color: rgba(255,255,255,0.8);
  background: rgba(255,255,255,0.05);
}

/* Widget Footer */
.lv-airport-widget-footer {
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid rgba(30,58,95,0.15);
  text-align: center;
}

.lv-airport-disclaimer {
  font-size: 9px;
  color: rgba(30,58,95,0.5);
  line-height: 1.3;
}

/* Mobile */
@media (max-width: 480px) {
  .lv-airport-widget {
    padding: 10px;
    border-radius: 10px;
    margin-top: 10px;
  }
  
  .lv-airport-widget-header {
    margin-bottom: 12px;
  }
  
  .lv-airport-widget-icon {
    font-size: 28px;
    margin-bottom: 4px;
  }
  
  .lv-airport-widget-title {
    font-size: 14px;
  }
  
  .lv-airport-widget-subtitle {
    font-size: 11px;
  }
  
  .lv-bus-card {
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 10px;
  }
  
  .lv-bus-card-header {
    flex-direction: column;
    margin-bottom: 10px;
    gap: 6px;
  }
  
  .lv-bus-badge {
    min-width: 34px;
    height: 24px;
    padding: 0 8px;
    font-size: 12px;
  }
  
  .lv-bus-operator {
    font-size: 12px;
  }
  
  .lv-bus-card-info {
    gap: 6px;
  }
  
  .lv-bus-duration, .lv-bus-price, .lv-bus-luggage {
    font-size: 10px;
    padding: 3px 6px;
  }
  
  .lv-bus-directions {
    gap: 5px;
    margin-bottom: 10px;
  }
  
  .lv-bus-dir-btn {
    padding: 8px 8px;
    font-size: 11px;
    border-radius: 8px;
  }
  
  .lv-bus-next-departures {
    margin-bottom: 10px;
  }
  
  .lv-next-dep-title {
    font-size: 9px;
    margin-bottom: 6px;
  }
  
  .lv-next-dep-list {
    gap: 5px;
  }
  
  .lv-next-dep-item {
    padding: 8px 10px;
    gap: 8px;
    border-radius: 8px;
  }
  
  .lv-next-dep-time {
    font-size: 14px;
    min-width: 50px;
  }
  
  .lv-next-dep-countdown {
    font-size: 11px;
  }
  
  .lv-next-dep-badge {
    font-size: 9px;
    padding: 2px 6px;
  }
  
  .lv-bus-map-container {
    margin-top: 10px;
    border-radius: 8px;
  }
  
  .lv-bus-map-title {
    padding: 6px 10px;
    font-size: 9px;
  }
  
  .lv-bus-mini-map {
    height: 80px;
  }
  
  .lv-bus-stop-address {
    padding: 6px 10px;
    font-size: 10px;
  }
  
  .lv-airport-widget-footer {
    margin-top: 10px;
    padding-top: 10px;
  }
  
  .lv-airport-disclaimer {
    font-size: 9px;
  }
}

/* ================= BOTTOM BAR MOBILE ================= */
#lv-bottom-bar {
  display: none;
}
</style>
</head>
<body>

<div id="lv-container">

  <!-- HEADER -->
  <div id="lv-header">
    <div id="lv-header-title">üöå Lovely Venice Apartments</div>
    <div id="lv-header-subtitle">Orari autobus in tempo reale</div>
    <div id="lv-live">
      <div class="lv-live-dot"></div>
      <div class="lv-live-text" id="lv-live-text">LIVE</div>
    </div>
  </div>

  <!-- SELECT -->
  <div id="lv-menu-row">
    <select id="lv-apartment-select" class="lv-select">
      <option value="sweet">Sweet Dream Apartment</option>
      <option value="skyline">Skyline Apartment</option>
      <option value="dreamstudio">Dream Studio</option>
      <option value="station">Station Apartment</option>
    </select>
    <select id="lv-lang-select" class="lv-lang">
      <option value="en">EN</option>
      <option value="it">IT</option>
      <option value="de">DE</option>
      <option value="es">ES</option>
      <option value="fr">FR</option>
    </select>
  </div>

  <!-- NEW WIDGET DESIGN -->
  <div class="lv-widget-container">
    
    <!-- OUTBOUND CARD -->
    <div class="lv-route-card" id="lv-outbound-card">
      <div class="lv-route-header">
        <div class="lv-route-icon">üöå</div>
        <div class="lv-route-info">
          <div class="lv-route-title" id="lv-outbound-title">Verso Venezia</div>
          <div class="lv-route-subtitle" id="lv-outbound-subtitle">‚è±Ô∏è 15 min ¬∑ üí∂ ‚Ç¨1.50 (‚Ç¨3 A/R)</div>
        </div>
        <div class="lv-route-badge" id="lv-outbound-line">2</div>
      </div>
      
      <div class="lv-route-departures">
        <div class="lv-dep-label" id="lv-dep-label-out">Prossime partenze</div>
        <div class="lv-dep-list lv-dep-list-horizontal" id="lv-outbound-deps">
          <!-- Populated by JS -->
        </div>
      </div>
    </div>

    <!-- RETURN CARD -->
    <div class="lv-route-card lv-route-card-return" id="lv-return-card">
      <div class="lv-route-header">
        <div class="lv-route-icon">üè†</div>
        <div class="lv-route-info">
          <div class="lv-route-title" id="lv-return-title">Ritorno Appartamento</div>
          <div class="lv-route-subtitle" id="lv-return-subtitle">‚è±Ô∏è 15 min ¬∑ üí∂ ‚Ç¨1.50 (‚Ç¨3 A/R)</div>
        </div>
        <div class="lv-route-badge lv-badge-return" id="lv-return-line">2</div>
      </div>
      
      <div class="lv-route-departures">
        <div class="lv-dep-label" id="lv-dep-label-ret">Prossime partenze</div>
        <div class="lv-dep-list lv-dep-list-horizontal" id="lv-return-deps">
          <!-- Populated by JS -->
        </div>
      </div>
    </div>

    <!-- ALL PRICES BUTTON -->
    <button class="lv-prices-full-btn" onclick="openPricesPopup()">
      <span class="lv-prices-full-btn-icon">üí∂</span>
      <span class="lv-prices-full-btn-text" id="lv-all-prices-btn-text">Tutti i prezzi biglietti</span>
    </button>

    <!-- STOP & MAP SECTION -->
    <div class="lv-stop-card">
      <div class="lv-stop-header">
        <div class="lv-stop-icon-big">üìç</div>
        <div class="lv-stop-info-text">
          <div class="lv-stop-name" id="lv-stop-title">Fermata</div>
          <div class="lv-walk-time" id="lv-walktime">Distanza a piedi</div>
        </div>
      </div>
      <iframe id="lv-map-iframe" class="lv-mini-map"></iframe>
      <div class="lv-stop-buttons">
        <a id="lv-nav-btn" class="lv-btn lv-btn-primary" target="_blank" rel="noopener noreferrer">üìç Apri Maps</a>
        <a id="lv-ticket-btn" class="lv-btn lv-btn-secondary"
           href="https://www.veneziaunica.it/en/e-commerce/services"
           target="_blank" rel="noopener noreferrer">üé´ Biglietti ACTV</a>
      </div>
    </div>

  </div>

</div>

<!-- PRICES POPUP MODAL -->
<div class="lv-prices-popup-overlay" id="lv-prices-popup">
  <div class="lv-prices-popup">
    <button class="lv-prices-popup-close" onclick="closePricesPopup()">‚úï</button>
    <div class="lv-prices-popup-title">
      <span id="lv-popup-prices-title">Prezzi biglietti ACTV</span>
    </div>
    <div class="lv-prices-popup-grid">
      <div class="lv-prices-popup-item">
        <span class="lv-price-label" id="lv-popup-bus-label">Biglietto Bus</span>
        <span class="lv-price-value">‚Ç¨1.50</span>
      </div>
      <div class="lv-prices-popup-item">
        <span class="lv-price-label" id="lv-popup-vaporetto-label">Biglietto Vaporetto</span>
        <span class="lv-price-value">‚Ç¨9.50</span>
      </div>
      <div class="lv-prices-popup-item">
        <span class="lv-price-label" id="lv-popup-pass1-label">Pass 1 giorno</span>
        <span class="lv-price-value">‚Ç¨25</span>
      </div>
      <div class="lv-prices-popup-item">
        <span class="lv-price-label" id="lv-popup-pass2-label">Pass 2 giorni</span>
        <span class="lv-price-value">‚Ç¨35</span>
      </div>
      <div class="lv-prices-popup-item">
        <span class="lv-price-label" id="lv-popup-pass3-label">Pass 3 giorni</span>
        <span class="lv-price-value">‚Ç¨45</span>
      </div>
      <div class="lv-prices-popup-item">
        <span class="lv-price-label" id="lv-popup-pass7-label">Pass 7 giorni</span>
        <span class="lv-price-value">‚Ç¨65</span>
      </div>
    </div>
    <div class="lv-prices-popup-notes">
      <div class="lv-prices-popup-note" id="lv-popup-ticket-info-contactless">
        üí≥ I biglietti sono acquistabili direttamente in autobus in modalit√† contactless.
      </div>
      <div class="lv-prices-popup-note" id="lv-popup-ticket-info-physical">
        üé´ In caso di biglietto fisico, √® acquistabile in qualsiasi tabacchino vicino al vostro appartamento.
      </div>
    </div>
  </div>
</div>

<!-- ================= AIRPORT BUS SECTION (Redesigned) ================= -->
<div class="lv-airport-widget" id="lv-airport-widget">
  
  <div class="lv-airport-widget-header">
    <div class="lv-airport-widget-icon">‚úàÔ∏è</div>
    <div class="lv-airport-widget-title" id="lv-airport-title">Bus per Aeroporto Marco Polo (VCE)</div>
    <div class="lv-airport-widget-subtitle" id="lv-airport-subtitle">Da Mestre Stazione FS</div>
  </div>

  <div class="lv-widget-container" style="padding: 0;">
    
    <!-- BUS SERVICE SELECTOR -->
    <div class="lv-airport-bus-selector">
      <div class="lv-airport-bus-selector-label">üëá Scegli il servizio bus:</div>
      <select class="lv-airport-bus-select" id="lv-marcopolo-bus-select" onchange="switchMarcopoBus(this.value)">
        <option value="atvo">üü† ATVO Shuttle (20 min ¬∑ ‚Ç¨10 ¬∑ bagagli inclusi)</option>
        <option value="linea15">üî¥ LINEA 15 ACTV (25 min ¬∑ ‚Ç¨10)</option>
      </select>
    </div>
    
    <!-- SINGLE CARD: Verso Aeroporto -->
    <div class="lv-route-card lv-route-card-atvo" id="lv-marcopolo-out-card">
      <div class="lv-route-header">
        <div class="lv-route-icon">üõ´</div>
        <div class="lv-route-info">
          <div class="lv-route-title" id="lv-marcopolo-out-title">ATVO Shuttle ‚Üí Aeroporto</div>
          <div class="lv-route-subtitle" id="lv-marcopolo-out-subtitle">‚è±Ô∏è 20 min ¬∑ üí∂ ‚Ç¨10 (‚Ç¨18 A/R) ¬∑ üß≥</div>
        </div>
        <div class="lv-route-badge" id="lv-marcopolo-out-badge">ATVO</div>
      </div>
      
      <div class="lv-route-departures">
        <div class="lv-dep-label" id="lv-marcopolo-out-label">Prossime partenze da Mestre FS</div>
        <div class="lv-dep-list lv-dep-list-horizontal" id="marcopolo-out-deps">
          <!-- Populated by JS -->
        </div>
      </div>
    </div>

    <!-- SINGLE CARD: Verso Mestre -->
    <div class="lv-route-card lv-route-card-return" id="lv-marcopolo-ret-card">
      <div class="lv-route-header">
        <div class="lv-route-icon">üõ¨</div>
        <div class="lv-route-info">
          <div class="lv-route-title" id="lv-marcopolo-ret-title">ATVO Shuttle ‚Üí Mestre</div>
          <div class="lv-route-subtitle" id="lv-marcopolo-ret-subtitle">‚è±Ô∏è 20 min ¬∑ üí∂ ‚Ç¨10 (‚Ç¨18 A/R) ¬∑ üß≥</div>
        </div>
        <div class="lv-route-badge" id="lv-marcopolo-ret-badge">ATVO</div>
      </div>
      
      <div class="lv-route-departures">
        <div class="lv-dep-label" id="lv-marcopolo-ret-label">Prossime partenze da Aeroporto</div>
        <div class="lv-dep-list lv-dep-list-horizontal" id="marcopolo-ret-deps">
          <!-- Populated by JS -->
        </div>
      </div>
    </div>

    <!-- STOP & MAP SECTION -->
    <div class="lv-stop-card">
      <div class="lv-stop-header">
        <div class="lv-stop-icon-big" id="lv-marcopolo-stop-icon">üü†</div>
        <div class="lv-stop-info-text">
          <div class="lv-stop-name" id="lv-marcopolo-stop-name">Fermata ATVO Shuttle</div>
          <div class="lv-walk-time" id="lv-marcopolo-stop-addr">Piazzale Stazione FS Mestre</div>
        </div>
      </div>
      
      <iframe class="lv-mini-map" id="lv-marcopolo-map" src="https://www.google.com/maps?q=Mestre+FS+ATVO&hl=it&z=18&output=embed"></iframe>
      
      <div class="lv-stop-buttons">
        <a href="https://www.google.com/maps/dir/?api=1&destination=Mestre+FS+ATVO&travelmode=walking" class="lv-btn lv-btn-primary" target="_blank" id="lv-marcopolo-nav">üìç Naviga</a>
        <a href="https://ecommerce.atvo.it/ecommerce-fe/" class="lv-btn lv-btn-secondary" target="_blank" id="lv-marcopolo-ticket">üé´ Biglietti ATVO</a>
      </div>
    </div>

  </div>
  
  <div class="lv-airport-widget-footer">
    <div class="lv-airport-disclaimer" id="lv-disclaimer">
      ‚ö†Ô∏è Gli orari possono variare. Per maggiore accuratezza, consulta i siti ufficiali delle compagnie di trasporto.
    </div>
  </div>

</div>

<!-- ================= TREVISO AIRPORT BUS SECTION ================= -->
<div class="lv-airport-widget lv-treviso-widget" id="lv-treviso-widget">
  
  <div class="lv-airport-widget-header">
    <div class="lv-airport-widget-icon">‚úàÔ∏è</div>
    <div class="lv-airport-widget-title" id="lv-treviso-title">Bus per Aeroporto di Treviso (TSF)</div>
    <div class="lv-airport-widget-subtitle" id="lv-treviso-subtitle">Da Mestre Stazione FS</div>
  </div>

  <div class="lv-widget-container" style="padding: 0;">
    
    <!-- ATVO/Brusutti - Verso Treviso Airport -->
    <div class="lv-route-card lv-route-card-treviso" id="lv-treviso-out-card">
      <div class="lv-route-header">
        <div class="lv-route-icon">üõ´</div>
        <div class="lv-route-info">
          <div class="lv-route-title" id="lv-treviso-out-title">ATVO Shuttle ‚Üí Aeroporto Treviso</div>
          <div class="lv-route-subtitle">‚è±Ô∏è 40 min ¬∑ üí∂ ‚Ç¨12 (‚Ç¨22 A/R) ¬∑ üß≥</div>
        </div>
        <div class="lv-route-badge lv-badge-treviso">TSF</div>
      </div>
      
      <div class="lv-route-departures">
        <div class="lv-dep-label" id="lv-treviso-out-label">Prossime partenze da Mestre FS</div>
        <div class="lv-dep-list lv-dep-list-horizontal" id="treviso-out-deps">
          <!-- Populated by JS -->
        </div>
      </div>
    </div>

    <!-- ATVO/Brusutti - Da Treviso Airport -->
    <div class="lv-route-card lv-route-card-return" id="lv-treviso-ret-card">
      <div class="lv-route-header">
        <div class="lv-route-icon">üõ¨</div>
        <div class="lv-route-info">
          <div class="lv-route-title" id="lv-treviso-ret-title">ATVO Shuttle ‚Üí Mestre</div>
          <div class="lv-route-subtitle">‚è±Ô∏è 40 min ¬∑ üí∂ ‚Ç¨12 (‚Ç¨22 A/R) ¬∑ üß≥</div>
        </div>
        <div class="lv-route-badge lv-badge-return">TSF</div>
      </div>
      
      <div class="lv-route-departures">
        <div class="lv-dep-label" id="lv-treviso-ret-label">Prossime partenze da Aeroporto Treviso</div>
        <div class="lv-dep-list lv-dep-list-horizontal" id="treviso-ret-deps">
          <!-- Populated by JS -->
        </div>
      </div>
    </div>

    <!-- STOP & MAP SECTION - TREVISO WITH SELECTOR -->
    <div class="lv-stop-card">
      <!-- MAP SELECTOR TABS -->
      <div class="lv-map-selector">
        <button class="lv-map-tab lv-map-tab-treviso active" id="lv-tab-treviso-out" onclick="switchTrevisoMap('out')">
          <span class="lv-tab-label" id="lv-tab-treviso-out-label">Partenza da Mestre</span>
        </button>
        <button class="lv-map-tab lv-map-tab-treviso" id="lv-tab-treviso-ret" onclick="switchTrevisoMap('ret')">
          <span class="lv-tab-label" id="lv-tab-treviso-ret-label">Partenza da Treviso</span>
        </button>
      </div>
      
      <!-- DYNAMIC STOP INFO -->
      <div class="lv-stop-header">
        <div class="lv-stop-icon-big" id="lv-treviso-stop-icon">üü£</div>
        <div class="lv-stop-info-text">
          <div class="lv-stop-name" id="lv-treviso-stop-name">Fermata Bus Mestre FS</div>
          <div class="lv-walk-time" id="lv-treviso-stop-addr">Mestre Stazione FS (fronte stazione)</div>
        </div>
      </div>
      
      <!-- DYNAMIC MAP -->
      <iframe class="lv-mini-map" id="lv-treviso-map" src="https://www.google.com/maps?q=Mestre+Stazione+FS+bus&hl=it&z=18&output=embed"></iframe>
      
      <!-- DYNAMIC BUTTONS -->
      <div class="lv-stop-buttons">
        <a href="https://www.google.com/maps/dir/?api=1&destination=Mestre+Stazione+FS&travelmode=walking" class="lv-btn lv-btn-primary" target="_blank" id="lv-treviso-nav">üìç Naviga</a>
        <a href="https://ecommerce.atvo.it/ecommerce-fe/" class="lv-btn lv-btn-secondary" target="_blank" id="lv-treviso-ticket">üé´ Biglietti ATVO</a>
      </div>
    </div>

  </div>
  
  <div class="lv-airport-widget-footer">
    <div class="lv-airport-disclaimer" id="lv-treviso-disclaimer">
      ‚ö†Ô∏è Gli orari possono variare. Per maggiore accuratezza, consulta i siti ufficiali delle compagnie di trasporto.
    </div>
  </div>

</div>

<!-- BOTTOM BAR (hidden) -->
<div id="lv-bottom-bar">
    <a id="lv-bottom-nav-btn" href="#" target="_blank" rel="noopener noreferrer">Navigazione</a>
    <a id="lv-bottom-ticket-btn"
      href="https://www.veneziaunica.it/en/e-commerce/services"
      target="_blank" rel="noopener noreferrer">Biglietti ACTV</a>
</div>


<script>
/* ================= MULTILINGUA ================= */

// Rileva automaticamente la lingua dal sito Lodgify
function detectSiteLanguage() {
  var supportedLangs = ['it', 'en', 'de', 'es', 'fr'];
  
  // Metodo 1: dall'URL - pattern Lodgify (es: /en, /it, /de, /en/, /it/)
  var path = window.location.pathname;
  // Cerca /xx o /xx/ all'inizio del path
  var urlLangMatch = path.match(/^\/(it|en|de|es|fr)(\/|$)/);
  if (urlLangMatch) {
    console.log('[BusWidget] Lingua rilevata da URL:', urlLangMatch[1]);
    return urlLangMatch[1];
  }
  
  // Metodo 2: dall'attributo lang dell'HTML
  var htmlLang = document.documentElement.lang ? document.documentElement.lang.substring(0, 2).toLowerCase() : null;
  if (htmlLang && supportedLangs.indexOf(htmlLang) !== -1) {
    console.log('[BusWidget] Lingua rilevata da HTML lang:', htmlLang);
    return htmlLang;
  }
  
  // Metodo 3: da Lodgify (se presente)
  if (typeof Lodgify !== 'undefined' && Lodgify.locale) {
    var lodgifyLang = Lodgify.locale.substring(0, 2).toLowerCase();
    if (supportedLangs.indexOf(lodgifyLang) !== -1) {
      console.log('[BusWidget] Lingua rilevata da Lodgify.locale:', lodgifyLang);
      return lodgifyLang;
    }
  }
  
  // Metodo 4: dal browser
  var browserLang = navigator.language ? navigator.language.substring(0, 2).toLowerCase() : null;
  if (browserLang && supportedLangs.indexOf(browserLang) !== -1) {
    console.log('[BusWidget] Lingua rilevata da browser:', browserLang);
    return browserLang;
  }
  
  // Default: inglese
  console.log('[BusWidget] Nessuna lingua rilevata, uso default: en');
  return 'en';
}

let LANG = detectSiteLanguage();

const I18N = {
  it: {
    headerSubtitle: "Orari autobus in tempo reale",
    outbound: "Verso Venezia (Piazzale Roma)",
    inbound: "Da Venezia ‚Üí Appartamento",
    stopPiave: "Fermata Piave Fiume",
    stopMiranese: "Fermata Miranese Monteverdi",
    stopVempa: "Fermata Cavalcavia Vempa",
    walkSweet: "Distanza a piedi: 2 minuti dal Sweet Dream Apartment",
    walkSky: "Distanza a piedi: 3 minuti dallo Skyline Apartment",
    walkDreamStudio: "Distanza a piedi: 2 minuti dal Dream Studio",
    walkStation: "Distanza a piedi: 1 minuto dallo Station Apartment",
    nextDepartures: "Prossime partenze",
    noMoreToday: "Nessuna altra corsa per oggi",
    minutes: "min",
    navBtn: "Apri Google Maps",
    navBottom: "Navigazione",
    ticketBtn: "Acquista biglietto ACTV",
    ticketBottom: "Biglietti ACTV",
    live: "LIVE ‚Äì Aggiornamento in tempo reale",
    busLabel: "Bus",
    nextBus: "Prossimo autobus",
    pricesTitle: "üí∂ Prezzi biglietti",
    allPrices: "Tutti i prezzi",
    priceBus: "Biglietto Bus",
    priceVaporetto: "Biglietto Vaporetto",
    pricePass1: "Pass 1 giorno",
    pricePass2: "Pass 2 giorni",
    pricePass3: "Pass 3 giorni",
    pricePass7: "Pass 7 giorni",
    ticketInfoContactless: "üí≥ I biglietti sono acquistabili direttamente in autobus in modalit√† contactless.",
    ticketInfoPhysical: "üé´ In caso di biglietto fisico, quest'ultimo √® acquistabile in qualsiasi tabacchino vicino al vostro appartamento.",
    // Airport section
    airportTitle: "Bus per Aeroporto Marco Polo (VCE)",
    airportSubtitle: "Da Mestre Stazione FS",
    linea15ToAirport: "LINEA 15 ACTV ‚Üí Aeroporto",
    linea15ToMestre: "LINEA 15 ACTV ‚Üí Mestre",
    atvoToAirport: "ATVO Shuttle ‚Üí Aeroporto",
    atvoToMestre: "ATVO Shuttle ‚Üí Mestre",
    depFromMestre: "Prossime partenze da Mestre FS",
    depFromAirport: "Prossime partenze da Aeroporto",
    stopLinea15: "Fermata LINEA 15 ACTV",
    stopLinea15Addr: "Via Cappuccina (lato Stazione FS)",
    stopAtvo: "Fermata ATVO Shuttle",
    stopAtvoAddr: "Piazzale Favretti (fronte Stazione FS)",
    navigate: "Naviga",
    ticketsActv: "Biglietti ACTV",
    ticketsAtvo: "Biglietti ATVO",
    schedulesActv: "Orari ACTV",
    schedulesAtvo: "Orari ATVO",
    disclaimer: "‚ö†Ô∏è Gli orari possono variare. Per maggiore accuratezza, consulta i siti ufficiali delle compagnie di trasporto.",
    // Treviso Airport section
    trevisoTitle: "Bus per Aeroporto di Treviso (TSF)",
    trevisoSubtitle: "Da Mestre Stazione FS",
    trevisoToAirport: "ATVO Shuttle ‚Üí Aeroporto Treviso",
    trevisoToMestre: "ATVO Shuttle ‚Üí Mestre",
    depFromMestreTreviso: "Prossime partenze da Mestre FS",
    depFromTrevisoAirport: "Prossime partenze da Aeroporto Treviso",
    stopTreviso: "Fermata Bus Mestre FS",
    stopTrevisoAddr: "Mestre Stazione FS (fronte stazione)",
    tabTrevisoOut: "Partenza da Mestre",
    tabTrevisoRet: "Partenza da Treviso"
  },

  en: {
    headerSubtitle: "Real-time bus schedules",
    outbound: "To Venice (Piazzale Roma)",
    inbound: "From Venice ‚Üí Apartment",
    stopPiave: "Piave Fiume Bus Stop",
    stopMiranese: "Miranese Monteverdi Bus Stop",
    stopVempa: "Cavalcavia Vempa Bus Stop",
    walkSweet: "Walking distance: 2 min from Sweet Dream Apartment",
    walkSky: "Walking distance: 3 min from Skyline Apartment",
    walkDreamStudio: "Walking distance: 2 min from Dream Studio",
    walkStation: "Walking distance: 1 min from Station Apartment",
    nextDepartures: "Next departures",
    noMoreToday: "No more buses today",
    minutes: "min",
    navBtn: "Open Google Maps",
    navBottom: "Navigation",
    ticketBtn: "Buy Tickets Online",
    ticketBottom: "ACTV Tickets",
    live: "LIVE ‚Äì Real-time update",
    busLabel: "Bus line",
    nextBus: "Next bus",
    pricesTitle: "üí∂ Ticket prices",
    allPrices: "All prices",
    priceBus: "Bus ticket",
    priceVaporetto: "Vaporetto ticket",
    pricePass1: "1-day pass",
    pricePass2: "2-day pass",
    pricePass3: "3-day pass",
    pricePass7: "7-day pass",
    ticketInfoContactless: "üí≥ Tickets can be purchased directly on the bus via contactless payment.",
    ticketInfoPhysical: "üé´ For a physical ticket, you can buy one at any tobacco shop near your apartment.",
    // Airport section
    airportTitle: "Bus to Marco Polo Airport (VCE)",
    airportSubtitle: "From Mestre Train Station",
    linea15ToAirport: "LINE 15 ACTV ‚Üí Airport",
    linea15ToMestre: "LINE 15 ACTV ‚Üí Mestre",
    atvoToAirport: "ATVO Shuttle ‚Üí Airport",
    atvoToMestre: "ATVO Shuttle ‚Üí Mestre",
    depFromMestre: "Next departures from Mestre FS",
    depFromAirport: "Next departures from Airport",
    stopLinea15: "LINE 15 ACTV Bus Stop",
    stopLinea15Addr: "Via Cappuccina (near Train Station)",
    stopAtvo: "ATVO Shuttle Stop",
    stopAtvoAddr: "Piazzale Favretti (in front of Train Station)",
    navigate: "Navigate",
    ticketsActv: "ACTV Tickets",
    ticketsAtvo: "ATVO Tickets",
    schedulesActv: "ACTV Schedules",
    schedulesAtvo: "ATVO Schedules",
    disclaimer: "‚ö†Ô∏è Schedules may vary. For accuracy, please check the official transport company websites.",
    // Treviso Airport section
    trevisoTitle: "Bus to Treviso Airport (TSF)",
    trevisoSubtitle: "From Mestre Train Station",
    trevisoToAirport: "ATVO Shuttle ‚Üí Treviso Airport",
    trevisoToMestre: "ATVO Shuttle ‚Üí Mestre",
    depFromMestreTreviso: "Next departures from Mestre FS",
    depFromTrevisoAirport: "Next departures from Treviso Airport",
    stopTreviso: "Mestre FS Bus Stop",
    stopTrevisoAddr: "Mestre Train Station (in front)",
    tabTrevisoOut: "From Mestre",
    tabTrevisoRet: "From Treviso"
  },

  de: {
    headerSubtitle: "Busfahrpl√§ne in Echtzeit",
    outbound: "Nach Venedig (Piazzale Roma)",
    inbound: "Von Venedig ‚Üí Apartment",
    stopPiave: "Haltestelle Piave Fiume",
    stopMiranese: "Haltestelle Miranese Monteverdi",
    stopVempa: "Haltestelle Cavalcavia Vempa",
    walkSweet: "Fu√üweg: 2 Min. vom Sweet Dream Apartment",
    walkSky: "Fu√üweg: 3 Min. vom Skyline Apartment",
    walkDreamStudio: "Fu√üweg: 2 Min. vom Dream Studio",
    walkStation: "Fu√üweg: 1 Min. vom Station Apartment",
    nextDepartures: "N√§chste Abfahrten",
    noMoreToday: "Keine weiteren Busse heute",
    minutes: "Min",
    navBtn: "Google Maps √∂ffnen",
    navBottom: "Navigation",
    ticketBtn: "Tickets online kaufen",
    ticketBottom: "ACTV Tickets",
    live: "LIVE ‚Äì Echtzeit-Update",
    busLabel: "Buslinie",
    nextBus: "N√§chster Bus",
    pricesTitle: "üí∂ Ticketpreise",
    allPrices: "Alle Preise",
    priceBus: "Busticket",
    priceVaporetto: "Vaporetto-Ticket",
    pricePass1: "1-Tages-Pass",
    pricePass2: "2-Tages-Pass",
    pricePass3: "3-Tages-Pass",
    pricePass7: "7-Tages-Pass",
    ticketInfoContactless: "üí≥ Tickets k√∂nnen direkt im Bus kontaktlos bezahlt werden.",
    ticketInfoPhysical: "üé´ Physische Tickets sind in jedem Tabakladen in der N√§he erh√§ltlich.",
    airportTitle: "Bus zum Flughafen Marco Polo (VCE)",
    airportSubtitle: "Ab Mestre Bahnhof",
    linea15ToAirport: "LINIE 15 ACTV ‚Üí Flughafen",
    linea15ToMestre: "LINIE 15 ACTV ‚Üí Mestre",
    atvoToAirport: "ATVO Shuttle ‚Üí Flughafen",
    atvoToMestre: "ATVO Shuttle ‚Üí Mestre",
    depFromMestre: "N√§chste Abfahrten ab Mestre FS",
    depFromAirport: "N√§chste Abfahrten ab Flughafen",
    stopLinea15: "Haltestelle LINIE 15 ACTV",
    stopLinea15Addr: "Via Cappuccina (beim Bahnhof)",
    stopAtvo: "ATVO Shuttle Haltestelle",
    stopAtvoAddr: "Piazzale Favretti (vor dem Bahnhof)",
    navigate: "Navigieren",
    ticketsActv: "ACTV Tickets",
    ticketsAtvo: "ATVO Tickets",
    schedulesActv: "ACTV Fahrpl√§ne",
    schedulesAtvo: "ATVO Fahrpl√§ne",
    disclaimer: "‚ö†Ô∏è Fahrpl√§ne k√∂nnen variieren. Bitte √ºberpr√ºfen Sie die offiziellen Websites.",
    trevisoTitle: "Bus zum Flughafen Treviso (TSF)",
    trevisoSubtitle: "Ab Mestre Bahnhof",
    trevisoToAirport: "ATVO Shuttle ‚Üí Flughafen Treviso",
    trevisoToMestre: "ATVO Shuttle ‚Üí Mestre",
    depFromMestreTreviso: "N√§chste Abfahrten ab Mestre FS",
    depFromTrevisoAirport: "N√§chste Abfahrten ab Flughafen Treviso",
    stopTreviso: "Haltestelle Mestre FS",
    stopTrevisoAddr: "Mestre Bahnhof (vor dem Bahnhof)",
    tabTrevisoOut: "Ab Mestre",
    tabTrevisoRet: "Ab Treviso"
  },

  es: {
    headerSubtitle: "Horarios de autob√∫s en tiempo real",
    outbound: "Hacia Venecia (Piazzale Roma)",
    inbound: "Desde Venecia ‚Üí Apartamento",
    stopPiave: "Parada Piave Fiume",
    stopMiranese: "Parada Miranese Monteverdi",
    stopVempa: "Parada Cavalcavia Vempa",
    walkSweet: "Distancia a pie: 2 min desde Sweet Dream Apartment",
    walkSky: "Distancia a pie: 3 min desde Skyline Apartment",
    walkDreamStudio: "Distancia a pie: 2 min desde Dream Studio",
    walkStation: "Distancia a pie: 1 min desde Station Apartment",
    nextDepartures: "Pr√≥ximas salidas",
    noMoreToday: "No hay m√°s autobuses hoy",
    minutes: "min",
    navBtn: "Abrir Google Maps",
    navBottom: "Navegaci√≥n",
    ticketBtn: "Comprar billetes online",
    ticketBottom: "Billetes ACTV",
    live: "EN VIVO ‚Äì Actualizaci√≥n en tiempo real",
    busLabel: "L√≠nea de bus",
    nextBus: "Pr√≥ximo autob√∫s",
    pricesTitle: "üí∂ Precios de billetes",
    allPrices: "Todos los precios",
    priceBus: "Billete de bus",
    priceVaporetto: "Billete de Vaporetto",
    pricePass1: "Pase 1 d√≠a",
    pricePass2: "Pase 2 d√≠as",
    pricePass3: "Pase 3 d√≠as",
    pricePass7: "Pase 7 d√≠as",
    ticketInfoContactless: "üí≥ Los billetes se pueden comprar directamente en el autob√∫s con pago contactless.",
    ticketInfoPhysical: "üé´ Los billetes f√≠sicos se pueden comprar en cualquier estanco cercano.",
    airportTitle: "Bus al Aeropuerto Marco Polo (VCE)",
    airportSubtitle: "Desde Mestre Estaci√≥n FS",
    linea15ToAirport: "L√çNEA 15 ACTV ‚Üí Aeropuerto",
    linea15ToMestre: "L√çNEA 15 ACTV ‚Üí Mestre",
    atvoToAirport: "ATVO Shuttle ‚Üí Aeropuerto",
    atvoToMestre: "ATVO Shuttle ‚Üí Mestre",
    depFromMestre: "Pr√≥ximas salidas desde Mestre FS",
    depFromAirport: "Pr√≥ximas salidas desde el Aeropuerto",
    stopLinea15: "Parada L√çNEA 15 ACTV",
    stopLinea15Addr: "Via Cappuccina (junto a la estaci√≥n)",
    stopAtvo: "Parada ATVO Shuttle",
    stopAtvoAddr: "Piazzale Favretti (frente a la estaci√≥n)",
    navigate: "Navegar",
    ticketsActv: "Billetes ACTV",
    ticketsAtvo: "Billetes ATVO",
    schedulesActv: "Horarios ACTV",
    schedulesAtvo: "Horarios ATVO",
    disclaimer: "‚ö†Ô∏è Los horarios pueden variar. Consulte los sitios web oficiales.",
    trevisoTitle: "Bus al Aeropuerto de Treviso (TSF)",
    trevisoSubtitle: "Desde Mestre Estaci√≥n FS",
    trevisoToAirport: "ATVO Shuttle ‚Üí Aeropuerto Treviso",
    trevisoToMestre: "ATVO Shuttle ‚Üí Mestre",
    depFromMestreTreviso: "Pr√≥ximas salidas desde Mestre FS",
    depFromTrevisoAirport: "Pr√≥ximas salidas desde Aeropuerto Treviso",
    stopTreviso: "Parada Mestre FS",
    stopTrevisoAddr: "Mestre Estaci√≥n FS (frente a la estaci√≥n)",
    tabTrevisoOut: "Desde Mestre",
    tabTrevisoRet: "Desde Treviso"
  },

  fr: {
    headerSubtitle: "Horaires de bus en temps r√©el",
    outbound: "Vers Venise (Piazzale Roma)",
    inbound: "De Venise ‚Üí Appartement",
    stopPiave: "Arr√™t Piave Fiume",
    stopMiranese: "Arr√™t Miranese Monteverdi",
    stopVempa: "Arr√™t Cavalcavia Vempa",
    walkSweet: "Distance √† pied: 2 min du Sweet Dream Apartment",
    walkSky: "Distance √† pied: 3 min du Skyline Apartment",
    walkDreamStudio: "Distance √† pied: 2 min du Dream Studio",
    walkStation: "Distance √† pied: 1 min du Station Apartment",
    nextDepartures: "Prochains d√©parts",
    noMoreToday: "Plus de bus aujourd'hui",
    minutes: "min",
    navBtn: "Ouvrir Google Maps",
    navBottom: "Navigation",
    ticketBtn: "Acheter des billets en ligne",
    ticketBottom: "Billets ACTV",
    live: "EN DIRECT ‚Äì Mise √† jour en temps r√©el",
    busLabel: "Ligne de bus",
    nextBus: "Prochain bus",
    pricesTitle: "üí∂ Prix des billets",
    allPrices: "Tous les prix",
    priceBus: "Billet de bus",
    priceVaporetto: "Billet Vaporetto",
    pricePass1: "Pass 1 jour",
    pricePass2: "Pass 2 jours",
    pricePass3: "Pass 3 jours",
    pricePass7: "Pass 7 jours",
    ticketInfoContactless: "üí≥ Les billets peuvent √™tre achet√©s directement dans le bus par paiement sans contact.",
    ticketInfoPhysical: "üé´ Les billets physiques peuvent √™tre achet√©s dans n'importe quel bureau de tabac √† proximit√©.",
    airportTitle: "Bus pour l'A√©roport Marco Polo (VCE)",
    airportSubtitle: "Depuis Mestre Gare FS",
    linea15ToAirport: "LIGNE 15 ACTV ‚Üí A√©roport",
    linea15ToMestre: "LIGNE 15 ACTV ‚Üí Mestre",
    atvoToAirport: "ATVO Shuttle ‚Üí A√©roport",
    atvoToMestre: "ATVO Shuttle ‚Üí Mestre",
    depFromMestre: "Prochains d√©parts de Mestre FS",
    depFromAirport: "Prochains d√©parts de l'A√©roport",
    stopLinea15: "Arr√™t LIGNE 15 ACTV",
    stopLinea15Addr: "Via Cappuccina (pr√®s de la gare)",
    stopAtvo: "Arr√™t ATVO Shuttle",
    stopAtvoAddr: "Piazzale Favretti (devant la gare)",
    navigate: "Naviguer",
    ticketsActv: "Billets ACTV",
    ticketsAtvo: "Billets ATVO",
    schedulesActv: "Horaires ACTV",
    schedulesAtvo: "Horaires ATVO",
    disclaimer: "‚ö†Ô∏è Les horaires peuvent varier. Consultez les sites officiels des compagnies.",
    trevisoTitle: "Bus pour l'A√©roport de Tr√©vise (TSF)",
    trevisoSubtitle: "Depuis Mestre Gare FS",
    trevisoToAirport: "ATVO Shuttle ‚Üí A√©roport Tr√©vise",
    trevisoToMestre: "ATVO Shuttle ‚Üí Mestre",
    depFromMestreTreviso: "Prochains d√©parts de Mestre FS",
    depFromTrevisoAirport: "Prochains d√©parts de l'A√©roport Tr√©vise",
    stopTreviso: "Arr√™t Mestre FS",
    stopTrevisoAddr: "Mestre Gare FS (devant la gare)",
    tabTrevisoOut: "Depuis Mestre",
    tabTrevisoRet: "Depuis Tr√©vise"
  }
};

/* ================= Fermate ‚Üí mappe e linee bus ================= */
const STOP_CONFIG = {
  // Sweet Dream Apartment ‚Üí Piave Fiume, linea 2 di giorno, N1 di notte
  sweet: {
    key: "piave",
    mapQuery: "Fermata bus Piave Fiume Mestre",
    lines: {
      day: "2",
      night: "N1"
    }
  },

  // Skyline Apartment ‚Üí Piave Fiume, stessa logica di Sweet Dream
  skyline: {
    key: "piave",
    mapQuery: "Fermata bus Piave Fiume Mestre",
    lines: {
      day: "2",
      night: "N1"
    }
  },

  // Dream Studio ‚Üí Miranese Monteverdi, solo linea 7 (niente notte)
  dreamstudio: {
    key: "miranese",
    mapQuery: "Fermata bus Miranese Monteverdi Mestre",
    lines: {
      day: "7(E-L)",
      night: null       // nessun bus notturno
    },
    multiLine: false
  },

  // Station Apartment ‚Üí Vempa, linea 2 e linea 7 di giorno, N1 di notte
  station: {
    key: "vempa",
    mapQuery: "Fermata Cavalcavia Vempa Mestre",
    lines: {
      day: ["2", "7(E-L)"],   // entrambe le linee
      night: "N1"
    },
    multiLine: true
  }
};

/* ================= ORARI PIAVE FIUME verso Venezia (Linea 2) ================= */
const OUTBOUND_WEEKDAY ={
"05":["05:02","05:30","05:32","05:47"],
"06":["06:00","06:11","06:12","06:24","06:36","06:48"],
"07":["07:00","07:06","07:12","07:18","07:24","07:30","07:36","07:48"],
"08":["08:00","08:12","08:20","08:24","08:36","08:48"],
"09":["09:00","09:10","09:12","09:24","09:36","09:48"],
"10":["10:00","10:12","10:24","10:36","10:48"],
"11":["11:00","11:12","11:24","11:36","11:48"],
"12":["12:00","12:12","12:24","12:36","12:48"],
"13":["13:00","13:12","13:24","13:36","13:48"],
"14":["14:00","14:12","14:24","14:36","14:48"],
"15":["15:00","15:12","15:24","15:36","15:48"],
"16":["16:00","16:12","16:24","16:36","16:48"],
"17":["17:00","17:12","17:24","17:36","17:48"],
"18":["18:00","18:12","18:24","18:36","18:48"],
"19":["19:00","19:12","19:24","19:36","19:48"],
"20":["20:00","20:12","20:24","20:36","20:48"],
"21":["21:02","21:16","21:31","21:50"],
"22":["22:05","22:17","22:35","22:47","23:05","23:17","23:35","23:47"],
"23":["23:05","23:17","23:35","23:47"],
"00":["00:05","00:17","00:47"]
};

const OUTBOUND_SATURDAY = OUTBOUND_WEEKDAY;

/* FESTIVO - Piave Fiume verso Venezia */
const OUTBOUND_SUNDAY ={
"05":["05:12","05:42"],
"06":["06:12","06:42"],
"07":["07:12","07:42","08:12","08:42"],
"08":["08:12","08:42"],
"09":["09:01","09:12","09:31","09:42"],
"10":["10:01","10:12","10:31","10:42"],
"11":["11:01","11:12","11:31","11:42"],
"12":["12:01","12:12","12:42"],
"13":["13:12","13:42"],
"14":["14:12","14:42"],
"15":["15:12","15:42"],
"16":["16:31","16:42","17:01","17:12","17:31","17:42"],
"17":["17:01","17:12","17:31","17:42"],
"18":["18:01","18:12","18:31","18:42"],
"19":["19:01","19:12","19:31","19:42"],
"20":["20:01","20:12","20:42"],
"21":["21:17","21:47"],
"22":["22:17","22:47"],
"23":["23:17"]
};

/* ================= ORARI MIRANESE MONTEVERDI (Dream Studio) - Linea 7 + 7E-L ================= */
const MIRANESE_OUTBOUND_WEEKDAY ={
"06":["06:00","06:20","06:40"],
"07":["07:00","07:10","07:20","07:24","07:34","07:40"],
"08":["08:00","08:20","08:40"],
"09":["09:00","09:10","09:20","09:40"],
"10":["10:00","10:20","10:40"],
"11":["11:00","11:20","11:40"],
"12":["12:00","12:20","12:40"],
"13":["13:00","13:08","13:20","13:28","13:40","13:48"],
"14":["14:00","14:08","14:28","14:40","14:48"],
"15":["15:00","15:08","15:20","15:28","15:40","15:48"],
"16":["16:00","16:08","16:20","16:28","16:40","16:48"],
"17":["17:00","17:08","17:20","17:28","17:40","17:48"],
"18":["18:00","18:08","18:20","18:28","18:40","18:48"],
"19":["19:00","19:08","19:20","19:28","19:40","19:48"],
"20":["20:00","20:08","20:20","20:28","20:57"],
"21":["21:24","21:54"],
"22":["22:24","22:54"],
"23":["23:24"],
"00":["00:09"]
};

const MIRANESE_OUTBOUND_SATURDAY = MIRANESE_OUTBOUND_WEEKDAY;

const MIRANESE_OUTBOUND_SUNDAY ={
"05":["05:29","05:52"],
"06":["06:12","06:32","06:52"],
"07":["07:12","07:32"],
"08":["08:00","08:14","08:28","08:44","08:58"],
"09":["09:14","09:28","09:44","09:58"],
"10":["10:14","10:28","10:44","10:58"],
"11":["11:14","11:28","11:44","11:58"],
"12":["12:14","12:28","12:44","12:58"],
"13":["13:14","13:28","13:44","13:58"],
"14":["14:14","14:28","14:44","14:58"],
"15":["15:14","15:28","15:44","15:58"],
"16":["16:14","16:28","16:44","16:58"],
"17":["17:14","17:28","17:44","17:58"],
"18":["18:14","18:44","18:58"],
"19":["19:14","19:28","19:44","19:58"],
"20":["20:14","20:28","20:44","20:59"],
"21":["21:24","21:54"],
"22":["22:24","22:54"],
"23":["23:24"],
"00":["00:09"]
};

/* ================= ORARI VEMPA verso Venezia (Linea 2) ================= */
const VEMPA_OUTBOUND_WEEKDAY ={
"05":["05:04","05:33","05:34","05:49"],
"06":["06:02","06:14","06:26","06:38","06:50"],
"07":["07:02","07:08","07:14","07:20","07:26","07:32","07:38","07:50"],
"08":["08:02","08:03","08:14","08:23","08:26","08:35","08:38","08:50"],
"09":["09:02","09:13","09:14","09:26","09:38","09:50"],
"10":["10:02","10:14","10:26","10:38","10:50"],
"11":["11:02","11:14","11:26","11:38","11:50"],
"12":["12:02","12:14","12:26","12:38","12:50"],
"13":["13:02","13:14","13:26","13:38","13:50"],
"14":["14:02","14:14","14:26","14:38","14:50"],
"15":["15:02","15:14","15:26","15:38","15:50"],
"16":["16:02","16:14","16:26","16:38","16:50"],
"17":["17:02","17:14","17:26","17:38","17:50"],
"18":["18:02","18:14","18:26","18:38","18:50"],
"19":["19:02","19:14","19:26","19:38","19:50"],
"20":["20:02","20:14","20:26","20:38","20:50"],
"21":["21:02","21:19","21:31","21:50"],
"22":["22:08","22:19","22:38","22:49"],
"23":["23:08","23:19","23:38","23:49"],
"00":["00:08","00:19","00:49"]
};

const VEMPA_OUTBOUND_SATURDAY = VEMPA_OUTBOUND_WEEKDAY;

/* FESTIVO - Vempa verso Venezia (Linea 2) */
const VEMPA_OUTBOUND_SUNDAY ={
"05":["05:14","05:44"],
"06":["06:14","06:44"],
"07":["07:14","07:44"],
"08":["08:14","08:44"],
"09":["09:03","09:14","09:33","09:44"],
"10":["10:03","10:14","10:33","10:44"],
"11":["11:03","11:14","11:33","11:44"],
"12":["12:03","12:14","12:44"],
"13":["13:14","13:44"],
"14":["14:14","14:44"],
"15":["15:14","15:44"],
"16":["16:33","16:44"],
"17":["17:03","17:14","17:33","17:44"],
"18":["18:03","18:14","18:33","18:44"],
"19":["19:03","19:14","19:33","19:44"],
"20":["20:03","20:14","20:44"],
"21":["21:19","21:49"],
"22":["22:19","22:49"],
"23":["23:19"]
};

const OUTBOUND_NIGHT ={
"00":["00:09","00:35"],"01":["01:05","01:35"],"02":["02:05","02:35"],
"03":["03:05","03:35"],"04":["04:05","04:35"],"05":["05:05"]
};

/* ORARI NOTTURNI VEMPA verso Venezia (N1) */
const VEMPA_OUTBOUND_NIGHT ={
"00":["00:11","00:37"],"01":["01:07","01:37"],"02":["02:07","02:37"],
"03":["03:07","03:37"],"04":["04:07","04:37"],"05":["05:07"]
};

/* RETURN = Partenze da Venezia A5 (Linea 2) ‚Üí Piave Fiume */
const RETURN_WEEKDAY ={
"05":["05:30"],
"06":["06:00","06:30","06:46","06:58"],
"07":["07:10","07:22","07:34","07:46","07:58"],
"08":["08:10","08:22","08:34","08:46","08:58"],
"09":["09:10","09:22","09:34","09:46","09:58"],
"10":["10:10","10:22","10:34","10:46","10:58"],
"11":["11:10","11:22","11:34","11:46","11:58"],
"12":["12:10","12:22","12:34","12:46","12:58"],
"13":["13:10","13:22","13:34","13:46","13:58"],
"14":["14:10","14:22","14:34","14:46","14:58"],
"15":["15:10","15:22","15:34","15:46","15:58"],
"16":["16:10","16:22","16:34","16:46","16:58"],
"17":["17:10","17:22","17:34","17:46","17:58"],
"18":["18:10","18:22","18:34","18:46","18:58"],
"19":["19:10","19:22","19:34","19:46","19:58"],
"20":["20:10","20:22","20:34","20:46"],
"21":["21:00","21:15","21:30","21:45"],
"22":["22:00","22:15","22:30","22:45"],
"23":["23:00","23:15","23:30","23:45"],
"00":["00:00","00:20","00:40"]
};

const RETURN_SATURDAY = RETURN_WEEKDAY;

/* FESTIVO = Partenze da Venezia A5 (Linea 2) ‚Üí Piave Fiume */
const RETURN_SUNDAY ={
"05":["05:45"],
"06":["06:15","06:45"],
"07":["07:15","07:45"],
"08":["08:15","08:45"],
"09":["09:15","09:30","09:45"],
"10":["10:00","10:15","10:30","10:45"],
"11":["11:00","11:15","11:30","11:45"],
"12":["12:15","12:45"],
"13":["13:15","13:45"],
"14":["14:15","14:45"],
"15":["15:15","15:45"],
"16":["16:00","16:15","16:30","16:45"],
"17":["17:00","17:15","17:30","17:45"],
"18":["18:00","18:15","18:30","18:45"],
"19":["19:00","19:15","19:30","19:45"],
"20":["20:00","20:15","20:30","20:45"],
"21":["21:00","21:15","21:45"],
"22":["22:15","22:45"],
"23":["23:15","23:45"],
"00":["00:20","00:40"]
};

const RETURN_NIGHT ={
"00":["00:21","00:51"],"01":["01:21","01:51"],"02":["02:21","02:51"],
"03":["03:21","03:51"],"04":["04:21","04:51"]
};

/* ================= ORARI VEMPA RETURN (Partenze da Venezia A5) - Linea 2 ================= */
const VEMPA_RETURN_WEEKDAY ={
"05":["05:30"],
"06":["06:00","06:30","06:46","06:58"],
"07":["07:10","07:22","07:34","07:46","07:58"],
"08":["08:10","08:22","08:34","08:46","08:58"],
"09":["09:10","09:22","09:34","09:46","09:58"],
"10":["10:10","10:22","10:34","10:46","10:58"],
"11":["11:10","11:22","11:34","11:46","11:58"],
"12":["12:10","12:22","12:34","12:46","12:58"],
"13":["13:10","13:22","13:34","13:46","13:58"],
"14":["14:10","14:22","14:34","14:46","14:58"],
"15":["15:10","15:22","15:34","15:46","15:58"],
"16":["16:10","16:22","16:34","16:46","16:58"],
"17":["17:10","17:22","17:34","17:46","17:58"],
"18":["18:10","18:22","18:34","18:46","18:58"],
"19":["19:10","19:22","19:34","19:46","19:58"],
"20":["20:10","20:22","20:34","20:46"],
"21":["21:00","21:15","21:30","21:45"],
"22":["22:00","22:15","22:30","22:45"],
"23":["23:00","23:15","23:30","23:45"],
"00":["00:00","00:20","00:40"]
};

const VEMPA_RETURN_SATURDAY = VEMPA_RETURN_WEEKDAY;

const VEMPA_RETURN_SUNDAY ={
"05":["05:45"],
"06":["06:15","06:45"],
"07":["07:15","07:45"],
"08":["08:15","08:45"],
"09":["09:15","09:30","09:45"],
"10":["10:00","10:15","10:30","10:45"],
"11":["11:00","11:15","11:30","11:45"],
"12":["12:15","12:45"],
"13":["13:15","13:45"],
"14":["14:15","14:45"],
"15":["15:15","15:45"],
"16":["16:15","16:30","16:45"],
"17":["17:00","17:15","17:30","17:45"],
"18":["18:00","18:15","18:30","18:45"],
"19":["19:00","19:15","19:30","19:45"],
"20":["20:00","20:15","20:30","20:45"],
"21":["21:00","21:15","21:45"],
"22":["22:15","22:45"],
"23":["23:15","23:45"],
"00":["00:20","00:40"]
};

/* ================= ORARI VEMPA LINEA 7 + 7E-L - Verso Venezia ================= */
const VEMPA_L7_OUTBOUND_WEEKDAY ={
"05":["05:20","05:40"],
"06":["06:00","06:15","06:30","06:45"],
"07":["07:00","07:15","07:30","07:45"],
"08":["08:00","08:15","08:30","08:45"],
"09":["09:00","09:20","09:40"],
"10":["10:00","10:20","10:40"],
"11":["11:00","11:20","11:40"],
"12":["12:00","12:20","12:40"],
"13":["13:00","13:14","13:20","13:34","13:40","13:54"],
"14":["14:00","14:14","14:20","14:34","14:40","14:54"],
"15":["15:00","15:14","15:20","15:34","15:40","15:54"],
"16":["16:00","16:14","16:20","16:34","16:40","16:54"],
"17":["17:00","17:14","17:20","17:34","17:40","17:54"],
"18":["18:00","18:14","18:20","18:34","18:40","18:54"],
"19":["19:00","19:04","19:20","19:34","19:40","19:54"],
"20":["20:00","20:14","20:30","20:34"],
"21":["21:00","21:03","21:30"],
"22":["22:00","22:30"],
"23":["23:00","23:30"],
"00":["00:15"]
};

const VEMPA_L7_OUTBOUND_SATURDAY = VEMPA_L7_OUTBOUND_WEEKDAY;

const VEMPA_L7_OUTBOUND_SUNDAY ={
"05":["05:35","05:58"],
"06":["06:18","06:38","06:58"],
"07":["07:04","07:18","07:38"],
"08":["08:00","08:04","08:30","08:34"],
"09":["09:00","09:04","09:30","09:34"],
"10":["10:00","10:04","10:30","10:34"],
"11":["11:00","11:04","11:30","11:34"],
"12":["12:00","12:04","12:30","12:34"],
"13":["13:00","13:04","13:30","13:34"],
"14":["14:00","14:04","14:30","14:34"],
"15":["15:00","15:04","15:30","15:34"],
"16":["16:00","16:04","16:30","16:34"],
"17":["17:00","17:04","17:30","17:34"],
"18":["18:00","18:04","18:30"],
"19":["19:00","19:04","19:30","19:34"],
"20":["20:00","20:04","20:30","20:34"],
"21":["21:03","21:30"],
"22":["22:00","22:30"],
"23":["23:00","23:30"],
"00":["00:15"]
};

/* ================= ORARI VEMPA LINEA 7 - Da Venezia ================= */
const VEMPA_L7_RETURN_WEEKDAY ={
"05":["05:30","05:50"],
"06":["06:10","06:25","06:40","06:55"],
"07":["07:10","07:25","07:40","07:55"],
"08":["08:10","08:25","08:40","08:55"],
"09":["09:10","09:30","09:50"],
"10":["10:10","10:30","10:50"],
"11":["11:10","11:30","11:50"],
"12":["12:10","12:30","12:50"],
"13":["13:10","13:30","13:50"],
"14":["14:10","14:30","14:50"],
"15":["15:10","15:30","15:50"],
"16":["16:10","16:30","16:50"],
"17":["17:10","17:30","17:50"],
"18":["18:10","18:30","18:50"],
"19":["19:10","19:30","19:50"],
"20":["20:10","20:40"],
"21":["21:10","21:40"],
"22":["22:10","22:40"],
"23":["23:10"]
};

const VEMPA_L7_RETURN_SATURDAY = VEMPA_L7_RETURN_WEEKDAY;

const VEMPA_L7_RETURN_SUNDAY ={
"08":["08:10","08:40"],
"09":["09:10","09:40"],
"10":["10:10","10:40"],
"11":["11:10","11:40"],
"12":["12:10","12:40"],
"13":["13:10","13:40"],
"14":["14:10","14:40"],
"15":["15:10","15:40"],
"16":["16:10","16:40"],
"17":["17:10","17:40"],
"18":["18:10","18:40"],
"19":["19:10","19:40"],
"20":["20:10","20:40"]
};

/* ================= UTILS ================= */
function flatten(obj){
  // Avoid relying on flatMap for broader browser support
  return Object.keys(obj).sort().reduce((acc,h) => acc.concat(obj[h] || []), []);
}

function minutes(t){
  if(!t) return Infinity;
  const parts = (""+t).split(":").map(Number);
  if(parts.length<2 || Number.isNaN(parts[0]) || Number.isNaN(parts[1])) return Infinity;
  const [h,m]=parts; return h*60+m;
}

function nextTimes(list,now){
  if(!Array.isArray(list)) return [];
  return list.filter(t=>minutes(t)>=now).slice(0,6);
}

function dayType(d){ const x=d.getDay(); return x===0?"sunday":x===6?"saturday":"weekday"; }
function isNight(d){ return d.getHours()<5; }

/* ================= PRICES POPUP ================= */
function openPricesPopup() {
  const popup = document.getElementById('lv-prices-popup');
  popup.classList.add('active');
  
  // Blocca lo scroll del body e della pagina parent (Lodgify)
  document.body.style.overflow = 'hidden';
  document.documentElement.style.overflow = 'hidden';
  
  // Prova a bloccare anche il parent frame se in iframe
  try {
    if (window.parent && window.parent.document) {
      window.parent.document.body.style.overflow = 'hidden';
    }
  } catch(e) {}
}

function closePricesPopup() {
  const popup = document.getElementById('lv-prices-popup');
  popup.classList.remove('active');
  
  // Ripristina scroll
  document.body.style.overflow = '';
  document.documentElement.style.overflow = '';
  
  try {
    if (window.parent && window.parent.document) {
      window.parent.document.body.style.overflow = '';
    }
  } catch(e) {}
}

// Close popup on overlay click
document.addEventListener('click', function(e) {
  if (e.target.id === 'lv-prices-popup') {
    closePricesPopup();
  }
});

// Close popup on ESC key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closePricesPopup();
  }
});

function updatePricesPopupLanguage(L) {
  const allPricesBtnText = document.getElementById('lv-all-prices-btn-text');
  const popupTitle = document.getElementById('lv-popup-prices-title');
  const popupBusLabel = document.getElementById('lv-popup-bus-label');
  const popupVaporettoLabel = document.getElementById('lv-popup-vaporetto-label');
  const popupPass1Label = document.getElementById('lv-popup-pass1-label');
  const popupPass2Label = document.getElementById('lv-popup-pass2-label');
  const popupPass3Label = document.getElementById('lv-popup-pass3-label');
  const popupPass7Label = document.getElementById('lv-popup-pass7-label');
  const popupContactless = document.getElementById('lv-popup-ticket-info-contactless');
  const popupPhysical = document.getElementById('lv-popup-ticket-info-physical');
  
  if (allPricesBtnText) allPricesBtnText.innerText = L.allPrices || 'Tutti i prezzi';
  if (popupTitle) popupTitle.innerText = L.pricesTitle;
  if (popupBusLabel) popupBusLabel.innerText = L.priceBus;
  if (popupVaporettoLabel) popupVaporettoLabel.innerText = L.priceVaporetto;
  if (popupPass1Label) popupPass1Label.innerText = L.pricePass1;
  if (popupPass2Label) popupPass2Label.innerText = L.pricePass2;
  if (popupPass3Label) popupPass3Label.innerText = L.pricePass3;
  if (popupPass7Label) popupPass7Label.innerText = L.pricePass7;
  if (popupContactless) popupContactless.innerText = L.ticketInfoContactless;
  if (popupPhysical) popupPhysical.innerText = L.ticketInfoPhysical;
}

/* ================= RENDER ================= */
function renderWidget(){

  const now = new Date();
  const nowMin = now.getHours()*60 + now.getMinutes();
  const dt = dayType(now);
  const night = isNight(now);
  const L = I18N[LANG] || I18N['it']; // Fallback a italiano se lingua non trovata

  const apt=document.getElementById("lv-apartment-select")?.value || 'sweet';
  const stopCfg=STOP_CONFIG[apt];

  // Update titles
  document.getElementById("lv-outbound-title").innerText = L.outbound;
  document.getElementById("lv-return-title").innerText = L.inbound;
  document.getElementById("lv-live-text").innerText = L.live;
  
  // Update header subtitle
  const headerSubtitle = document.getElementById("lv-header-subtitle");
  if(headerSubtitle) headerSubtitle.innerText = L.headerSubtitle;

  // Update subtitles con prezzo biglietto
  const outSubtitle = document.getElementById("lv-outbound-subtitle");
  const retSubtitle = document.getElementById("lv-return-subtitle");
  const priceText = "‚è±Ô∏è 15 min ¬∑ üí∂ ‚Ç¨1.50 (‚Ç¨3 A/R)";
  if(outSubtitle) outSubtitle.innerText = priceText;
  if(retSubtitle) retSubtitle.innerText = priceText;

  // Update departure labels
  const depLabelOut = document.getElementById("lv-dep-label-out");
  const depLabelRet = document.getElementById("lv-dep-label-ret");
  if(depLabelOut) depLabelOut.innerText = L.nextDepartures;
  if(depLabelRet) depLabelRet.innerText = L.nextDepartures;

  const stopNames={
    piave:L.stopPiave,
    miranese:L.stopMiranese,
    vempa:L.stopVempa
  };
  document.getElementById("lv-stop-title").innerText = stopNames[stopCfg.key];

  const walkTxt={
    sweet:L.walkSweet,
    skyline:L.walkSky,
    dreamstudio:L.walkDreamStudio,
    station:L.walkStation
  };
  document.getElementById("lv-walktime").innerText = walkTxt[apt];

  /* MAPPA */
  document.getElementById("lv-map-iframe").src =
    "https://www.google.com/maps?q=" +
    encodeURIComponent(stopCfg.mapQuery) +
    "&hl="+(LANG==="it"?"it":"en")+"&z=18&output=embed";

  /* ORARI */
  let outTable, retTable;
  let outTableL7 = [], retTableL7 = [];
  const isVempa = (stopCfg.key === "vempa");
  const isMiranese = (stopCfg.key === "miranese");
  const isMultiLine = stopCfg.multiLine === true;

  if(night){
    if(apt==="dreamstudio"){
      outTable=[]; retTable=[];
    } else if(isVempa){
      outTable=flatten(VEMPA_OUTBOUND_NIGHT);
      retTable=flatten(RETURN_NIGHT);
    } else {
      outTable=flatten(OUTBOUND_NIGHT);
      retTable=flatten(RETURN_NIGHT);
    }
  } else if(dt==="sunday"){
    if(isVempa){
      outTable=flatten(VEMPA_OUTBOUND_SUNDAY);
      retTable=flatten(VEMPA_RETURN_SUNDAY);
      if(isMultiLine){
        outTableL7=flatten(VEMPA_L7_OUTBOUND_SUNDAY);
        retTableL7=flatten(VEMPA_L7_RETURN_SUNDAY);
      }
    } else if(isMiranese){
      outTable=flatten(MIRANESE_OUTBOUND_SUNDAY);
      retTable=flatten(RETURN_SUNDAY);
    } else {
      outTable=flatten(OUTBOUND_SUNDAY);
      retTable=flatten(RETURN_SUNDAY);
    }
  } else if(dt==="saturday"){
    if(isVempa){
      outTable=flatten(VEMPA_OUTBOUND_SATURDAY);
      retTable=flatten(VEMPA_RETURN_SATURDAY);
      if(isMultiLine){
        outTableL7=flatten(VEMPA_L7_OUTBOUND_SATURDAY);
        retTableL7=flatten(VEMPA_L7_RETURN_SATURDAY);
      }
    } else if(isMiranese){
      outTable=flatten(MIRANESE_OUTBOUND_SATURDAY);
      retTable=flatten(RETURN_SATURDAY);
    } else {
      outTable=flatten(OUTBOUND_SATURDAY);
      retTable=flatten(RETURN_SATURDAY);
    }
  } else {
    if(isVempa){
      outTable=flatten(VEMPA_OUTBOUND_WEEKDAY);
      retTable=flatten(VEMPA_RETURN_WEEKDAY);
      if(isMultiLine){
        outTableL7=flatten(VEMPA_L7_OUTBOUND_WEEKDAY);
        retTableL7=flatten(VEMPA_L7_RETURN_WEEKDAY);
      }
    } else if(isMiranese){
      outTable=flatten(MIRANESE_OUTBOUND_WEEKDAY);
      retTable=flatten(RETURN_WEEKDAY);
    } else {
      outTable=flatten(OUTBOUND_WEEKDAY);
      retTable=flatten(RETURN_WEEKDAY);
    }
  }

  // Combina orari con etichetta linea
  let combinedOut = [];
  let combinedRet = [];
  
  if(isMultiLine && !night){
    outTable.forEach(t => combinedOut.push({time: t, line: "2"}));
    outTableL7.forEach(t => combinedOut.push({time: t, line: "7(E-L)"}));
    combinedOut.sort((a,b) => minutes(a.time) - minutes(b.time));
    
    retTable.forEach(t => combinedRet.push({time: t, line: "2"}));
    retTableL7.forEach(t => combinedRet.push({time: t, line: "7(E-L)"}));
    combinedRet.sort((a,b) => minutes(a.time) - minutes(b.time));
  } else {
    const lineLabel = night ? (stopCfg.lines.night || "N1") : (Array.isArray(stopCfg.lines.day) ? stopCfg.lines.day[0] : stopCfg.lines.day);
    outTable.forEach(t => combinedOut.push({time: t, line: lineLabel}));
    retTable.forEach(t => combinedRet.push({time: t, line: lineLabel}));
  }

  // Filtra prossime partenze (3 per direzione)
  let nextOut = combinedOut.filter(item => minutes(item.time) >= nowMin).slice(0, 3);
  let nextRet = combinedRet.filter(item => minutes(item.time) >= nowMin).slice(0, 3);
  
  // Se non ci sono pi√π bus diurni e non √® gi√† notte, aggiungi i notturni
  if(nextOut.length === 0 && !night && apt !== "dreamstudio"){
    let nightOutTable, nightRetTable;
    if(isVempa){
      nightOutTable = flatten(VEMPA_OUTBOUND_NIGHT);
      nightRetTable = flatten(RETURN_NIGHT);
    } else {
      nightOutTable = flatten(OUTBOUND_NIGHT);
      nightRetTable = flatten(RETURN_NIGHT);
    }
    const nightLineLabel = stopCfg.lines.night || "N1";
    nightOutTable.forEach(t => {
      // Gli orari notturni (00:xx - 05:xx) vanno mostrati come "prossimi" dopo le 23:xx
      combinedOut.push({time: t, line: nightLineLabel, isNight: true});
    });
    nightRetTable.forEach(t => {
      combinedRet.push({time: t, line: nightLineLabel, isNight: true});
    });
    // Filtra solo i notturni (orari < 06:00 = minuti < 360)
    nextOut = combinedOut.filter(item => item.isNight).slice(0, 3);
    nextRet = combinedRet.filter(item => item.isNight).slice(0, 3);
  }

  // Update line badges
  const outLineBadge = document.getElementById("lv-outbound-line");
  const retLineBadge = document.getElementById("lv-return-line");
  if(outLineBadge && nextOut.length > 0) outLineBadge.innerText = nextOut[0].line;
  if(retLineBadge && nextRet.length > 0) retLineBadge.innerText = nextRet[0].line;

  // Render outbound departures
  const outDepsBox = document.getElementById("lv-outbound-deps");
  const inPrefix = LANG === "it" ? "tra" : "in";
  if(outDepsBox){
    if(nextOut.length === 0){
      outDepsBox.innerHTML = `<div class="lv-dep-no-more">${L.noMoreToday}</div>`;
    } else {
      outDepsBox.innerHTML = nextOut.map((item, i) => {
        let itemMin = minutes(item.time);
        // Se √® un orario notturno (dopo mezzanotte) e siamo ancora prima di mezzanotte, aggiungi 24 ore
        if(item.isNight && nowMin > 720) itemMin += 1440;
        const diff = itemMin - nowMin;
        const countdownClass = diff <= 10 ? "lv-dep-countdown lv-dep-countdown-soon" : "lv-dep-countdown";
        const countdownText = `${diff} min`;
        return `
          <div class="lv-dep-item">
            <div class="lv-dep-time-block">
              <span class="lv-dep-line-badge">${item.line}</span>
              <span class="lv-dep-time">${item.time}</span>
            </div>
            <span class="${countdownClass}">${i === 0 ? `${inPrefix} ${countdownText}` : countdownText}</span>
          </div>
        `;
      }).join('');
    }
  }

  // Render return departures
  const retDepsBox = document.getElementById("lv-return-deps");
  if(retDepsBox){
    if(nextRet.length === 0){
      retDepsBox.innerHTML = `<div class="lv-dep-no-more">${L.noMoreToday}</div>`;
    } else {
      retDepsBox.innerHTML = nextRet.map((item, i) => {
        let itemMin = minutes(item.time);
        // Se √® un orario notturno (dopo mezzanotte) e siamo ancora prima di mezzanotte, aggiungi 24 ore
        if(item.isNight && nowMin > 720) itemMin += 1440;
        const diff = itemMin - nowMin;
        const countdownClass = diff <= 10 ? "lv-dep-countdown lv-dep-countdown-soon" : "lv-dep-countdown";
        const countdownText = `${diff} min`;
        return `
          <div class="lv-dep-item">
            <div class="lv-dep-time-block">
              <span class="lv-dep-line-badge">${item.line}</span>
              <span class="lv-dep-time">${item.time}</span>
            </div>
            <span class="${countdownClass}">${i === 0 ? `${inPrefix} ${countdownText}` : countdownText}</span>
          </div>
        `;
      }).join('');
    }
  }

  /* NAVIGAZIONE GOOGLE */
  const baseNavUrl =
    "https://www.google.com/maps/dir/?api=1&destination=" +
    encodeURIComponent(stopCfg.mapQuery) +
    "&travelmode=walking";

  document.getElementById("lv-nav-btn").href=baseNavUrl;
  document.getElementById("lv-nav-btn").innerText=L.navBtn;

  /* BOTTONE BIGLIETTI */
  document.getElementById("lv-ticket-btn").innerText=L.ticketBtn;

  /* PREZZI BIGLIETTI */
  const pricesTitle = document.getElementById("lv-prices-title");
  if(pricesTitle) pricesTitle.innerText = L.pricesTitle;
  
  /* INFO BIGLIETTI - Aggiorna popup prezzi */
  updatePricesPopupLanguage(L);
  
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if(L[key]) el.innerText = L[key];
  });
}

/* EVENTI */
const _aptSelect = document.getElementById("lv-apartment-select");
if(_aptSelect){
  _aptSelect.addEventListener("change", () => renderWidget());
}

const _langSelect = document.getElementById("lv-lang-select");
if(_langSelect){
  _langSelect.value = LANG;
  _langSelect.addEventListener("change", () => {
    LANG = _langSelect.value;
    renderWidget();
    if (typeof renderAirportBusWidget === 'function') renderAirportBusWidget();
    if (typeof renderTrevisoWidget === 'function') renderTrevisoWidget();
  });
}

// Inizializza widget
try{
  renderWidget();
}catch(err){
  console.error('Error initializing widget:', err);
}

// Riprova la rilevazione lingua dopo che Lodgify potrebbe essere caricato
setTimeout(function() {
  var newLang = detectSiteLanguage();
  if (newLang !== LANG) {
    LANG = newLang;
    try {
      renderWidget();
      if (typeof renderAirportBusWidget === 'function') renderAirportBusWidget();
      if (typeof renderTrevisoWidget === 'function') renderTrevisoWidget();
    } catch(err) {
      console.error('Error re-rendering widgets:', err);
    }
  }
}, 500);

// Riprova anche dopo 1.5 secondi per essere sicuri
setTimeout(function() {
  var newLang = detectSiteLanguage();
  if (newLang !== LANG) {
    LANG = newLang;
    try {
      renderWidget();
      if (typeof renderAirportBusWidget === 'function') renderAirportBusWidget();
      if (typeof renderTrevisoWidget === 'function') renderTrevisoWidget();
    } catch(err) {
      console.error('Error re-rendering widgets:', err);
    }
  }
}, 1500);

// Aggiorna ogni 3 minuti
setInterval(renderWidget, 180000);

/* ================= AIRPORT BUS SCHEDULES ================= */
// LINEA 15 ACTV
const LINEA15_SCHEDULES = {
  departure: {
    // Da Mestre FS (612) verso Aeroporto
    feriale: ["06:32", "07:02", "07:32", "08:02", "08:32", "09:02", "09:32", "10:02",
              "10:32", "11:02", "11:32", "12:02", "12:32", "13:02", "13:32", "14:02",
              "14:32", "15:02", "15:32", "16:02", "16:32", "17:02", "17:32", "18:02",
              "18:32", "19:02", "19:32", "20:02"],
    festivo: ["06:55", "07:25", "07:55", "08:25", "08:55", "09:25", "09:55", "10:25",
              "10:55", "11:25", "11:55", "12:25", "12:55", "13:25", "13:55", "14:25",
              "14:55", "15:25", "15:55", "16:25", "16:55", "17:25", "17:55", "18:25",
              "18:55", "19:25", "19:55"]
  },
  arrival: {
    // Da Aeroporto (3626) verso Mestre FS
    feriale: ["05:45", "06:15", "06:45", "07:15", "07:45", "08:15", "08:45", "09:15",
              "09:45", "10:15", "10:45", "11:15", "11:45", "12:15", "12:45", "13:15",
              "13:45", "14:15", "14:45", "15:15", "15:45", "16:15", "16:45", "17:15",
              "17:45", "18:15", "18:45", "19:15", "19:45", "20:15"],
    festivo: ["07:19", "07:49", "08:19", "08:49", "09:19", "09:49", "10:19", "10:49",
              "11:19", "11:49", "12:19", "12:49", "13:19", "13:49", "14:19", "14:49",
              "15:19", "15:49", "16:19", "16:49", "17:19", "17:49", "18:19", "18:49",
              "19:19", "19:49", "20:19"]
  }
};

// ATVO SHUTTLE - combined schedules (feriale + tutti, festivo + tutti)
const ATVO_SCHEDULES = {
  departure: {
    feriale: ["05:00", "05:55", "07:40", "08:00", "08:15", "08:20", "08:35", "09:20", "09:25", "09:50", 
              "10:05", "10:15", "11:25", "11:50", "11:55", "12:00", "13:15", "13:20", "13:25", "14:00", 
              "14:10", "15:20", "15:25", "16:00", "16:25", "17:05", "18:10", "19:00", "19:20", "21:35",
              "21:45", "22:00", "22:30", "23:00"],
    festivo: ["04:20", "05:00", "05:45", "05:55", "06:40", "07:00", "07:20", "07:40", "08:15", "08:20", 
              "08:35", "08:50", "08:55", "09:00", "09:20", "09:50", "10:05", "10:15", "10:50", "10:55", 
              "11:15", "11:50", "11:55", "12:00", "12:25", "12:40", "13:20", "13:25", "14:00", "14:10",
              "14:20", "14:25", "15:00", "15:25", "16:00", "16:25", "17:05", "17:15", "17:35", "17:55",
              "19:00", "19:20", "19:50", "20:20", "20:50", "21:45", "22:00", "22:30", "23:00", "23:40", "00:40"]
  },
  arrival: {
    feriale: ["07:23", "07:50", "08:45", "08:53", "09:15", "09:25", "09:40", "10:10", "10:15", "10:45",
              "11:00", "11:08", "11:20", "12:15", "12:50", "13:08", "13:23", "13:53", "14:30", "14:40",
              "14:53", "15:08", "16:23", "16:50", "17:08", "17:10", "17:23", "19:20", "20:10", "20:38",
              "21:10", "23:40", "00:20"],
    festivo: ["06:10", "07:00", "07:23", "07:50", "08:10", "08:20", "08:25", "08:40", "08:53", "09:15",
              "09:25", "09:40", "10:10", "10:15", "10:30", "11:00", "11:08", "11:20", "11:35", "11:40",
              "12:05", "12:50", "13:08", "13:23", "13:38", "13:53", "14:13", "14:40", "14:53", "15:08",
              "15:20", "15:40", "16:23", "16:45", "17:08", "17:10", "17:23", "17:45", "18:08", "18:15",
              "18:35", "20:10", "20:38", "21:10", "21:40", "22:10", "22:40", "23:20", "00:20", "01:10"]
  }
};

/* ================= TREVISO AIRPORT BUS SCHEDULES (ATVO/Brusutti) ================= */
// Mestre FS ‚Üí Treviso Airport (departure) / Treviso Airport ‚Üí Mestre FS (arrival)
const TREVISO_SCHEDULES = {
  departure: {
    // Mestre FS ‚Üí Treviso Airport (per giorno della settimana, usiamo feriale=lun-ven medio, festivo=domenica)
    lunedi: ["04:35", "05:15", "06:45", "07:15", "08:45", "09:15", "09:45", "10:15", "10:45", "11:15", "11:45", "12:15", "12:45", "13:45", "15:45", "16:15", "16:45", "17:15", "17:45", "18:15", "18:45"],
    martedi: ["04:35", "05:15", "06:45", "09:45", "10:15", "10:45", "11:45", "12:45", "13:15", "14:15", "14:45", "15:45", "16:15", "17:15"],
    mercoledi: ["04:35", "05:15", "05:45", "06:45", "08:45", "09:15", "10:45", "11:15", "13:15", "14:15", "15:15", "16:15", "17:15"],
    giovedi: ["04:35", "05:15", "05:45", "06:35", "08:15", "08:45", "09:45", "10:15", "10:45", "12:15", "12:45", "14:45", "15:15", "16:15", "17:15", "17:45", "18:15", "18:45"],
    venerdi: ["04:35", "05:15", "05:45", "06:15", "06:45", "07:15", "08:15", "09:15", "10:45", "11:15", "11:45", "12:15", "12:45", "13:15", "13:45", "15:15", "15:45", "16:15", "17:45", "18:15", "18:45"],
    sabato: ["04:35", "05:15", "06:15", "06:45", "08:15", "09:15", "09:45", "10:45", "11:15", "11:45", "12:15", "12:45", "13:15", "13:45", "15:15", "15:45", "16:15", "16:45", "17:15", "17:45", "18:15"],
    domenica: ["04:35", "05:15", "06:15", "06:45", "07:15", "08:45", "09:15", "09:45", "10:15", "10:55", "11:25", "12:45", "13:15", "13:45", "14:15", "14:45", "16:15", "16:45", "17:15", "18:15", "18:45"]
  },
  arrival: {
    // Treviso Airport ‚Üí Mestre FS (per giorno della settimana)
    lunedi: ["07:45", "09:00", "09:30", "09:45", "10:15", "11:30", "11:45", "12:30", "13:15", "13:45", "14:30", "14:45", "15:15", "15:30", "15:40", "16:40", "18:00", "19:00", "19:45", "20:00", "20:45", "21:00", "21:20", "22:00", "22:20"],
    martedi: ["07:45", "09:10", "12:10", "12:30", "12:45", "13:10", "14:20", "15:00", "15:25", "16:05", "16:30", "17:10", "17:45", "18:15", "18:30", "19:00", "20:00", "21:20"],
    mercoledi: ["07:45", "08:45", "09:10", "09:40", "11:30", "11:45", "13:45", "14:05", "16:25", "17:05", "17:25", "18:10", "19:00", "20:00", "20:20", "21:25", "22:20"],
    giovedi: ["07:45", "08:40", "08:50", "09:10", "11:10", "11:20", "12:00", "12:40", "13:00", "13:30", "15:00", "15:30", "17:10", "17:20", "18:10", "19:00", "19:15", "20:00", "20:35", "21:15", "21:20", "22:00"],
    venerdi: ["07:45", "08:10", "08:30", "09:10", "09:20", "09:30", "10:15", "11:00", "11:15", "12:00", "13:50", "14:20", "14:40", "14:50", "15:00", "15:25", "15:45", "16:50", "18:40", "19:00", "20:10", "20:30", "21:00", "21:40", "22:10"],
    sabato: ["07:45", "09:10", "09:35", "10:00", "11:00", "11:20", "11:30", "13:40", "13:50", "14:20", "15:00", "15:20", "15:40", "16:05", "16:25", "17:20", "18:30", "19:10", "20:00", "20:20", "21:00", "21:20", "22:00"],
    domenica: ["07:45", "08:45", "09:10", "09:45", "10:10", "10:30", "11:00", "11:20", "11:45", "12:40", "13:15", "14:25", "15:15", "15:45", "16:05", "17:10", "17:50", "18:35", "19:00", "19:20", "20:00", "21:00", "21:10", "21:30", "21:45"]
  }
};

function isFestivo() {
  const day = new Date().getDay();
  return day === 0; // Sunday
}

function getDayName() {
  const days = ['domenica', 'lunedi', 'martedi', 'mercoledi', 'giovedi', 'venerdi', 'sabato'];
  return days[new Date().getDay()];
}

function getNextDepartures(schedules, direction, count = 3) {
  const now = new Date();
  const currentMinutes = now.getHours() * 60 + now.getMinutes();
  const type = isFestivo() ? 'festivo' : 'feriale';
  const times = schedules[direction][type] || [];
  
  const upcoming = [];
  for (const time of times) {
    const [h, m] = time.split(':').map(Number);
    let busMinutes = h * 60 + m;
    
    // Handle after midnight times
    if (h < 4) busMinutes += 24 * 60;
    
    if (busMinutes > currentMinutes && upcoming.length < count) {
      const wait = busMinutes - currentMinutes;
      upcoming.push({ time, wait });
    }
  }
  
  // If not enough upcoming, add from beginning (tomorrow)
  if (upcoming.length < count) {
    for (const time of times) {
      if (upcoming.length >= count) break;
      const [h, m] = time.split(':').map(Number);
      const busMinutes = h * 60 + m;
      const wait = (24 * 60 - currentMinutes) + busMinutes;
      if (!upcoming.find(u => u.time === time)) {
        upcoming.push({ time, wait, tomorrow: true });
      }
    }
  }
  
  return upcoming;
}

function renderAirportDepartures(containerId, departures) {
  const container = document.getElementById(containerId);
  if (!container) return;
  
  const inPrefix = LANG === "it" ? "tra" : "in";
  
  container.innerHTML = departures.map((dep, i) => {
    const countdownClass = dep.wait <= 10 ? "lv-dep-countdown lv-dep-countdown-soon" : "lv-dep-countdown";
    const countdownText = dep.tomorrow 
      ? (LANG === 'it' ? 'domani' : 'tomorrow')
      : (dep.wait <= 60 ? `${inPrefix} ${dep.wait} min` : dep.time);
    
    return `
      <div class="lv-dep-item">
        <div class="lv-dep-time-block">
          <span class="lv-dep-time">${dep.time}</span>
        </div>
        <span class="${countdownClass}">${countdownText}</span>
      </div>
    `;
  }).join('');
}

// Stato corrente del bus selezionato per Marco Polo
let currentMarcopoBus = 'atvo';

function switchMarcopoBus(busType) {
  currentMarcopoBus = busType;
  updateMarcopoloBus();
  updateMarcopoloStopInfo();
}

function updateMarcopoloBus() {
  const schedules = currentMarcopoBus === 'atvo' ? ATVO_SCHEDULES : LINEA15_SCHEDULES;
  
  // Outbound (Mestre ‚Üí Airport)
  const outDeps = getNextDepartures(schedules, 'departure', 3);
  renderAirportDepartures('marcopolo-out-deps', outDeps);
  
  // Return (Airport ‚Üí Mestre)
  const retDeps = getNextDepartures(schedules, 'arrival', 3);
  renderAirportDepartures('marcopolo-ret-deps', retDeps);
  
  // Aggiorna titoli e badge
  const L = I18N[LANG] || I18N['it'];
  const outCard = document.getElementById('lv-marcopolo-out-card');
  const retCard = document.getElementById('lv-marcopolo-ret-card');
  const outTitle = document.getElementById('lv-marcopolo-out-title');
  const retTitle = document.getElementById('lv-marcopolo-ret-title');
  const outSubtitle = document.getElementById('lv-marcopolo-out-subtitle');
  const retSubtitle = document.getElementById('lv-marcopolo-ret-subtitle');
  const outBadge = document.getElementById('lv-marcopolo-out-badge');
  const retBadge = document.getElementById('lv-marcopolo-ret-badge');
  
  if(currentMarcopoBus === 'atvo') {
    if(outCard) outCard.className = 'lv-route-card lv-route-card-atvo';
    if(outTitle) outTitle.innerText = L.atvoToAirport || 'ATVO Shuttle ‚Üí Aeroporto';
    if(retTitle) retTitle.innerText = L.atvoToMestre || 'ATVO Shuttle ‚Üí Mestre';
    if(outSubtitle) outSubtitle.innerText = '‚è±Ô∏è 20 min ¬∑ üí∂ ‚Ç¨10 (‚Ç¨18 A/R) ¬∑ üß≥';
    if(retSubtitle) retSubtitle.innerText = '‚è±Ô∏è 20 min ¬∑ üí∂ ‚Ç¨10 (‚Ç¨18 A/R) ¬∑ üß≥';
    if(outBadge) { outBadge.innerText = 'ATVO'; outBadge.className = 'lv-route-badge lv-badge-atvo-orange'; }
    if(retBadge) { retBadge.innerText = 'ATVO'; retBadge.className = 'lv-route-badge lv-badge-return'; }
  } else {
    if(outCard) outCard.className = 'lv-route-card lv-route-card-airport';
    if(outTitle) outTitle.innerText = L.linea15ToAirport || 'LINEA 15 ACTV ‚Üí Aeroporto';
    if(retTitle) retTitle.innerText = L.linea15ToMestre || 'LINEA 15 ACTV ‚Üí Mestre';
    if(outSubtitle) outSubtitle.innerText = '‚è±Ô∏è 25 min ¬∑ üí∂ ‚Ç¨10';
    if(retSubtitle) retSubtitle.innerText = '‚è±Ô∏è 25 min ¬∑ üí∂ ‚Ç¨10';
    if(outBadge) { outBadge.innerText = '15'; outBadge.className = 'lv-route-badge lv-badge-actv-red'; }
    if(retBadge) { retBadge.innerText = '15'; retBadge.className = 'lv-route-badge lv-badge-return'; }
  }
}

function updateMarcopoloStopInfo() {
  const L = I18N[LANG] || I18N['it'];
  const stopIcon = document.getElementById('lv-marcopolo-stop-icon');
  const stopName = document.getElementById('lv-marcopolo-stop-name');
  const stopAddr = document.getElementById('lv-marcopolo-stop-addr');
  const mapFrame = document.getElementById('lv-marcopolo-map');
  const navBtn = document.getElementById('lv-marcopolo-nav');
  const ticketBtn = document.getElementById('lv-marcopolo-ticket');
  
  if(currentMarcopoBus === 'atvo') {
    if(stopIcon) stopIcon.innerText = 'üü†';
    if(stopName) stopName.innerText = L.stopAtvo || 'Fermata ATVO Shuttle';
    if(stopAddr) stopAddr.innerText = L.stopAtvoAddr || 'Piazzale Stazione FS Mestre';
    if(mapFrame) mapFrame.src = 'https://www.google.com/maps?q=Mestre+FS+ATVO&hl=' + (LANG === 'it' ? 'it' : 'en') + '&z=18&output=embed';
    if(navBtn) navBtn.href = 'https://www.google.com/maps/dir/?api=1&destination=Mestre+FS+ATVO&travelmode=walking';
    if(ticketBtn) {
      ticketBtn.href = 'https://ecommerce.atvo.it/ecommerce-fe/';
      ticketBtn.innerText = 'üé´ ' + (L.ticketsAtvo || 'Biglietti ATVO');
    }
  } else {
    if(stopIcon) stopIcon.innerText = 'üî¥';
    if(stopName) stopName.innerText = L.stopLinea15 || 'Fermata LINEA 15 ACTV';
    if(stopAddr) stopAddr.innerText = L.stopLinea15Addr || 'Via Cappuccina (lato Stazione FS)';
    if(mapFrame) mapFrame.src = 'https://www.google.com/maps?q=Via+Cappuccina+Mestre+fermata+bus&hl=' + (LANG === 'it' ? 'it' : 'en') + '&z=18&output=embed';
    if(navBtn) navBtn.href = 'https://www.google.com/maps/dir/?api=1&destination=Via+Cappuccina+Mestre&travelmode=walking';
    if(ticketBtn) {
      ticketBtn.href = 'https://www.veneziaunica.it/en/e-commerce/services';
      ticketBtn.innerText = 'üé´ ' + (L.ticketsActv || 'Biglietti ACTV');
    }
  }
}

function updateAirportBuses() {
  updateMarcopoloBus();
}

function updateAirportLabels() {
  const L = I18N[LANG] || I18N['it'];
  
  // Header
  const title = document.getElementById('lv-airport-title');
  const subtitle = document.getElementById('lv-airport-subtitle');
  if(title) title.innerText = L.airportTitle;
  if(subtitle) subtitle.innerText = L.airportSubtitle;
  
  // Aggiorna labels partenze
  const outLabel = document.getElementById('lv-marcopolo-out-label');
  const retLabel = document.getElementById('lv-marcopolo-ret-label');
  if(outLabel) outLabel.innerText = L.depFromMestre || 'Prossime partenze da Mestre FS';
  if(retLabel) retLabel.innerText = L.depFromAirport || 'Prossime partenze da Aeroporto';
  
  // Aggiorna bus info in base al selezionato
  updateMarcopoloBus();
  updateMarcopoloStopInfo();
  
  // Departure labels vecchi (per compatibilit√†)
  const linea15OutLabel = document.getElementById('lv-linea15-out-label');
  const linea15RetLabel = document.getElementById('lv-linea15-ret-label');
  const atvoOutLabel = document.getElementById('lv-atvo-out-label');
  const atvoRetLabel = document.getElementById('lv-atvo-ret-label');
  if(linea15OutLabel) linea15OutLabel.innerText = L.depFromMestre;
  if(linea15RetLabel) linea15RetLabel.innerText = L.depFromAirport;
  if(atvoOutLabel) atvoOutLabel.innerText = L.depFromMestre;
  if(atvoRetLabel) atvoRetLabel.innerText = L.depFromAirport;
  
  // Stop names
  const stopLinea15Name = document.getElementById('lv-stop-linea15-name');
  const stopLinea15Addr = document.getElementById('lv-stop-linea15-addr');
  const stopAtvoName = document.getElementById('lv-stop-atvo-name');
  const stopAtvoAddr = document.getElementById('lv-stop-atvo-addr');
  if(stopLinea15Name) stopLinea15Name.innerText = L.stopLinea15;
  if(stopLinea15Addr) stopLinea15Addr.innerText = L.stopLinea15Addr;
  if(stopAtvoName) stopAtvoName.innerText = L.stopAtvo;
  if(stopAtvoAddr) stopAtvoAddr.innerText = L.stopAtvoAddr;
  
  // Buttons
  const navLinea15 = document.getElementById('lv-nav-linea15');
  const navAtvo = document.getElementById('lv-nav-atvo');
  const ticketActv = document.getElementById('lv-ticket-actv');
  const ticketAtvo = document.getElementById('lv-ticket-atvo');
  if(navLinea15) navLinea15.innerText = 'üìç ' + L.navigate;
  if(navAtvo) navAtvo.innerText = 'üìç ' + L.navigate;
  if(ticketActv) ticketActv.innerText = 'üé´ ' + L.ticketsActv;
  if(ticketAtvo) ticketAtvo.innerText = 'üé´ ' + L.ticketsAtvo;
  
  // Footer links
  const linkActv = document.getElementById('lv-link-actv');
  const linkAtvo = document.getElementById('lv-link-atvo');
  const disclaimer = document.getElementById('lv-disclaimer');
  if(linkActv) linkActv.innerText = 'üìã ' + L.schedulesActv;
  if(linkAtvo) linkAtvo.innerText = 'üìã ' + L.schedulesAtvo;
  if(disclaimer) disclaimer.innerText = L.disclaimer;
}

// ================= TREVISO AIRPORT FUNCTIONS =================
function getNextTrevisoDepartures(direction, count = 3) {
  const now = new Date();
  const currentMinutes = now.getHours() * 60 + now.getMinutes();
  const dayName = getDayName();
  const times = TREVISO_SCHEDULES[direction][dayName] || [];
  
  const upcoming = [];
  for (const time of times) {
    const [h, m] = time.split(':').map(Number);
    let busMinutes = h * 60 + m;
    
    if (h < 4) busMinutes += 24 * 60;
    
    if (busMinutes > currentMinutes && upcoming.length < count) {
      const wait = busMinutes - currentMinutes;
      upcoming.push({ time, wait });
    }
  }
  
  if (upcoming.length < count) {
    for (const time of times) {
      if (upcoming.length >= count) break;
      const [h, m] = time.split(':').map(Number);
      const busMinutes = h * 60 + m;
      const wait = (24 * 60 - currentMinutes) + busMinutes;
      if (!upcoming.find(u => u.time === time)) {
        upcoming.push({ time, wait, tomorrow: true });
      }
    }
  }
  
  return upcoming;
}

function updateTreviso() {
  // Outbound (Mestre ‚Üí Treviso Airport)
  const outDeps = getNextTrevisoDepartures('departure', 3);
  renderAirportDepartures('treviso-out-deps', outDeps);
  
  // Return (Treviso Airport ‚Üí Mestre)
  const retDeps = getNextTrevisoDepartures('arrival', 3);
  renderAirportDepartures('treviso-ret-deps', retDeps);
}

function updateTrevisoLabels() {
  const L = I18N[LANG] || I18N['it'];
  
  // Header
  const title = document.getElementById('lv-treviso-title');
  const subtitle = document.getElementById('lv-treviso-subtitle');
  if(title) title.innerText = L.trevisoTitle;
  if(subtitle) subtitle.innerText = L.trevisoSubtitle;
  
  // Route titles
  const outTitle = document.getElementById('lv-treviso-out-title');
  const retTitle = document.getElementById('lv-treviso-ret-title');
  if(outTitle) outTitle.innerText = L.trevisoToAirport;
  if(retTitle) retTitle.innerText = L.trevisoToMestre;
  
  // Departure labels
  const outLabel = document.getElementById('lv-treviso-out-label');
  const retLabel = document.getElementById('lv-treviso-ret-label');
  if(outLabel) outLabel.innerText = L.depFromMestreTreviso;
  if(retLabel) retLabel.innerText = L.depFromTrevisoAirport;
  
  // Tab labels
  const tabOutLabel = document.getElementById('lv-tab-treviso-out-label');
  const tabRetLabel = document.getElementById('lv-tab-treviso-ret-label');
  if(tabOutLabel) tabOutLabel.innerText = L.tabTrevisoOut || 'Partenza Mestre';
  if(tabRetLabel) tabRetLabel.innerText = L.tabTrevisoRet || 'Arrivo Mestre';
  
  // Stop info (new IDs)
  const stopName = document.getElementById('lv-treviso-stop-name');
  const stopAddr = document.getElementById('lv-treviso-stop-addr');
  if(stopName) stopName.innerText = L.stopTreviso;
  if(stopAddr) stopAddr.innerText = L.stopTrevisoAddr;
  
  // Buttons (new IDs)
  const navBtn = document.getElementById('lv-treviso-nav');
  const ticketBtn = document.getElementById('lv-treviso-ticket');
  if(navBtn) navBtn.innerText = 'üìç ' + L.navigate;
  if(ticketBtn) ticketBtn.innerText = 'üé´ ' + L.ticketsAtvo;
  
  // Disclaimer
  const disclaimer = document.getElementById('lv-treviso-disclaimer');
  if(disclaimer) disclaimer.innerText = L.disclaimer;
}

/* ================= MAP SELECTOR FUNCTIONS ================= */

// Marco Polo Map Data
const MARCOPOLO_MAP_DATA = {
  linea15: {
    icon: 'üî¥',
    nameIt: 'Fermata LINEA 15 ACTV',
    nameEn: 'LINEA 15 ACTV Stop',
    addrIt: 'Via Cappuccina (lato Stazione FS)',
    addrEn: 'Via Cappuccina (near Train Station)',
    mapUrl: 'https://www.google.com/maps?q=Via+Cappuccina+Mestre+fermata+bus&hl=it&z=18&output=embed',
    navUrl: 'https://www.google.com/maps/dir/?api=1&destination=Via+Cappuccina+Mestre&travelmode=walking',
    ticketUrl: 'https://www.veneziaunica.it/en/e-commerce/services',
    ticketLabelIt: 'üé´ Biglietti ACTV',
    ticketLabelEn: 'üé´ ACTV Tickets'
  },
  atvo: {
    icon: 'üü†',
    nameIt: 'Fermata ATVO Shuttle',
    nameEn: 'ATVO Shuttle Stop',
    addrIt: 'Piazzale Favretti (fronte Stazione FS)',
    addrEn: 'Piazzale Favretti (in front of Train Station)',
    mapUrl: 'https://www.google.com/maps?q=Piazzale+Favretti+Mestre+Stazione&hl=it&z=18&output=embed',
    navUrl: 'https://www.google.com/maps/dir/?api=1&destination=Piazzale+Favretti+Mestre&travelmode=walking',
    ticketUrl: 'https://ecommerce.atvo.it/ecommerce-fe/',
    ticketLabelIt: 'üé´ Biglietti ATVO',
    ticketLabelEn: 'üé´ ATVO Tickets'
  }
};

// Treviso Map Data
const TREVISO_MAP_DATA = {
  out: {
    icon: 'üöå',
    nameIt: 'Fermata Bus Mestre FS',
    nameEn: 'Mestre FS Bus Stop',
    addrIt: 'Mestre Stazione FS (fronte stazione)',
    addrEn: 'Mestre Train Station (in front)',
    mapUrl: 'https://www.google.com/maps?q=Mestre+Stazione+FS+bus&hl=it&z=18&output=embed',
    navUrl: 'https://www.google.com/maps/dir/?api=1&destination=Mestre+Stazione+FS&travelmode=walking'
  },
  ret: {
    icon: '‚úàÔ∏è',
    nameIt: 'Fermata Aeroporto Treviso (TSF)',
    nameEn: 'Treviso Airport Stop (TSF)',
    addrIt: 'Aeroporto di Treviso - Uscita Arrivi',
    addrEn: 'Treviso Airport - Arrivals Exit',
    mapUrl: 'https://www.google.com/maps?q=Treviso+Airport+TSF+bus+stop&hl=it&z=18&output=embed',
    navUrl: 'https://www.google.com/maps/dir/?api=1&destination=Treviso+Airport&travelmode=walking'
  }
};

function switchMarcopoloMap(type) {
  const data = MARCOPOLO_MAP_DATA[type];
  if (!data) return;
  
  // Update tabs
  document.getElementById('lv-tab-linea15').classList.remove('active');
  document.getElementById('lv-tab-atvo').classList.remove('active');
  document.getElementById('lv-tab-' + type).classList.add('active');
  
  // Update icon
  const iconEl = document.getElementById('lv-marcopolo-stop-icon');
  if (iconEl) iconEl.textContent = data.icon;
  
  // Update name
  const nameEl = document.getElementById('lv-marcopolo-stop-name');
  if (nameEl) nameEl.textContent = LANG === 'it' ? data.nameIt : data.nameEn;
  
  // Update address
  const addrEl = document.getElementById('lv-marcopolo-stop-addr');
  if (addrEl) addrEl.textContent = LANG === 'it' ? data.addrIt : data.addrEn;
  
  // Update map
  const mapEl = document.getElementById('lv-marcopolo-map');
  if (mapEl) mapEl.src = data.mapUrl;
  
  // Update nav button
  const navEl = document.getElementById('lv-marcopolo-nav');
  if (navEl) navEl.href = data.navUrl;
  
  // Update ticket button
  const ticketEl = document.getElementById('lv-marcopolo-ticket');
  if (ticketEl) {
    ticketEl.href = data.ticketUrl;
    ticketEl.textContent = LANG === 'it' ? data.ticketLabelIt : data.ticketLabelEn;
  }
}

function switchTrevisoMap(type) {
  const data = TREVISO_MAP_DATA[type];
  if (!data) return;
  
  // Update tabs
  document.getElementById('lv-tab-treviso-out').classList.remove('active');
  document.getElementById('lv-tab-treviso-ret').classList.remove('active');
  document.getElementById('lv-tab-treviso-' + type).classList.add('active');
  
  // Update icon
  const iconEl = document.getElementById('lv-treviso-stop-icon');
  if (iconEl) iconEl.textContent = data.icon;
  
  // Update name
  const nameEl = document.getElementById('lv-treviso-stop-name');
  if (nameEl) nameEl.textContent = LANG === 'it' ? data.nameIt : data.nameEn;
  
  // Update address
  const addrEl = document.getElementById('lv-treviso-stop-addr');
  if (addrEl) addrEl.textContent = LANG === 'it' ? data.addrIt : data.addrEn;
  
  // Update map
  const mapEl = document.getElementById('lv-treviso-map');
  if (mapEl) mapEl.src = data.mapUrl;
  
  // Update nav button
  const navEl = document.getElementById('lv-treviso-nav');
  if (navEl) navEl.href = data.navUrl;
}

function renderTrevisoWidget() {
  updateTrevisoLabels();
  updateTreviso();
}

function renderAirportBusWidget() {
  updateAirportLabels();
  updateAirportBuses();
  renderTrevisoWidget();
}

// Initialize airport widget and set intervals
try {
  renderAirportBusWidget();
} catch(err) {
  console.error('Error initializing airport widget:', err);
}
setInterval(updateAirportBuses, 60000);
setInterval(updateTreviso, 60000);
</script>

</body>
</html>